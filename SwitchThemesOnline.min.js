Bridge.assembly("SwitchThemesOnline",function($asm,globals){"use strict";Bridge.define("ExtensionMethods.Extensions",{statics:{methods:{ReadVector3:function(bin){var $t;return $t=new SwitchThemes.Common.Vector3.ctor,$t.X=bin.ReadSingle(),$t.Y=bin.ReadSingle(),$t.Z=bin.ReadSingle(),$t},Write$1:function(bin,vec){bin.Write$13(vec.X);bin.Write$13(vec.Y);bin.Write$13(vec.Z)},Write:function(bin,vec){bin.Write$13(vec.X);bin.Write$13(vec.Y)},ReadVector2:function(bin){var $t;return $t=new SwitchThemes.Common.Vector2.ctor,$t.X=bin.ReadSingle(),$t.Y=bin.ReadSingle(),$t},Matches:function(arr,magic){return ExtensionMethods.Extensions.Matches$1(arr,0,System.String.toCharArray(magic,0,magic.length))},Matches$2:function(arr,startIndex,magic){return ExtensionMethods.Extensions.Matches$1(arr,startIndex,System.String.toCharArray(magic,0,magic.length))},Matches$1:function(arr,startIndex,magic){if(magic===void 0&&(magic=[]),System.Int64(arr.length).lt(System.Int64(magic.length).add(System.Int64(startIndex))))return!1;for(var i=0;System.Int64(i).lt(System.Int64(magic.length));i=i+1>>>0)if(arr[i+startIndex>>>0]!==magic[i])return!1;return!0},ContainsStr:function(arr,t){for(var i=0;i<arr.length;i=i+1|0)if(Bridge.referenceEquals(arr[i],t))return!0;return!1}}}});Bridge.define("SARCExt.SARC",{statics:{methods:{NameHash:function(name){for(var result=0,i=0;i<name.length;i=i+1|0)result=name.charCodeAt(i)+Bridge.Int.umul(result,101)>>>0;return result},StringHashToUint:function(name){var $t;if(System.String.contains(name,".")&&(name=($t=System.String.split(name,[46].map(function(i){return String.fromCharCode(i)})))[0]),name.length!==8)throw new System.Exception("Invalid hash length");return System.Convert.toNumberInBase(name,16,10)},GuessFileExtension:function(f){var Ext=".bin";return ExtensionMethods.Extensions.Matches(f,"SARC")?Ext=".sarc":ExtensionMethods.Extensions.Matches(f,"Yaz")?Ext=".szs":ExtensionMethods.Extensions.Matches(f,"YB")||ExtensionMethods.Extensions.Matches(f,"BY")?Ext=".byaml":ExtensionMethods.Extensions.Matches(f,"FRES")?Ext=".bfres":ExtensionMethods.Extensions.Matches(f,"Gfx2")?Ext=".gtx":ExtensionMethods.Extensions.Matches(f,"FLYT")?Ext=".bflyt":ExtensionMethods.Extensions.Matches(f,"CLAN")?Ext=".bclan":ExtensionMethods.Extensions.Matches(f,"CLYT")?Ext=".bclyt":ExtensionMethods.Extensions.Matches(f,"FLIM")?Ext=".bclim":ExtensionMethods.Extensions.Matches(f,"FLAN")?Ext=".bflan":ExtensionMethods.Extensions.Matches(f,"FSEQ")?Ext=".bfseq":ExtensionMethods.Extensions.Matches(f,"VFXB")?Ext=".pctl":ExtensionMethods.Extensions.Matches(f,"AAHS")?Ext=".sharc":ExtensionMethods.Extensions.Matches(f,"BAHS")?Ext=".sharcb":ExtensionMethods.Extensions.Matches(f,"BNTX")?Ext=".bntx":ExtensionMethods.Extensions.Matches(f,"BNSH")?Ext=".bnsh":ExtensionMethods.Extensions.Matches(f,"FSHA")?Ext=".bfsha":ExtensionMethods.Extensions.Matches(f,"FFNT")?Ext=".bffnt":ExtensionMethods.Extensions.Matches(f,"CFNT")?Ext=".bcfnt":ExtensionMethods.Extensions.Matches(f,"CSTM")?Ext=".bcstm":ExtensionMethods.Extensions.Matches(f,"FSTM")?Ext=".bfstm":ExtensionMethods.Extensions.Matches(f,"STM")?Ext=".bfsha":ExtensionMethods.Extensions.Matches(f,"CWAV")?Ext=".bcwav":ExtensionMethods.Extensions.Matches(f,"FWAV")?Ext=".bfwav":ExtensionMethods.Extensions.Matches(f,"CTPK")?Ext=".ctpk":ExtensionMethods.Extensions.Matches(f,"CGFX")?Ext=".bcres":ExtensionMethods.Extensions.Matches(f,"AAMP")?Ext=".aamp":ExtensionMethods.Extensions.Matches(f,"MsgStdBn")?Ext=".msbt":ExtensionMethods.Extensions.Matches(f,"MsgPrjBn")&&(Ext=".msbp"),Ext},GuessAlignment:function(files){var $t,res=4,f,fileRes;$t=Bridge.getEnumerator(files.getValues(),System.Array.type(System.Byte));try{while($t.moveNext())f=$t.Current,fileRes=SARCExt.SARC.GuessFileAlignment(f),res=fileRes>res?fileRes:res}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return res},GuessFileAlignment:function(f){return ExtensionMethods.Extensions.Matches(f,"SARC")?8192:ExtensionMethods.Extensions.Matches(f,"Yaz")?128:ExtensionMethods.Extensions.Matches(f,"YB")||ExtensionMethods.Extensions.Matches(f,"BY")?128:ExtensionMethods.Extensions.Matches(f,"FRES")||ExtensionMethods.Extensions.Matches(f,"Gfx2")||ExtensionMethods.Extensions.Matches(f,"AAHS")||ExtensionMethods.Extensions.Matches(f,"BAHS")?8192:ExtensionMethods.Extensions.Matches(f,"BNTX")||ExtensionMethods.Extensions.Matches(f,"BNSH")||ExtensionMethods.Extensions.Matches(f,"FSHA")?4096:ExtensionMethods.Extensions.Matches(f,"FFNT")?8192:ExtensionMethods.Extensions.Matches(f,"CFNT")?128:ExtensionMethods.Extensions.Matches$2(f,1,"STM")||ExtensionMethods.Extensions.Matches$2(f,1,"WAV")||ExtensionMethods.Extensions.Matches(f,"FSTP")?32:ExtensionMethods.Extensions.Matches(f,"CTPK")?16:ExtensionMethods.Extensions.Matches(f,"CGFX")?128:ExtensionMethods.Extensions.Matches(f,"AAMP")?8:ExtensionMethods.Extensions.Matches(f,"MsgStdBn")||ExtensionMethods.Extensions.Matches(f,"MsgPrjBn")?128:4},PackN:function(data,_align){var $t,$t1,$t2,$t3,offsetToUpdate,k,StringOffsets,k1,FileOffsets,k2,i;_align===void 0&&(_align=-1);var align=_align>=0?_align:SARCExt.SARC.GuessAlignment(data.Files)|0,o=new System.IO.MemoryStream.ctor,bw=new Syroot.BinaryData.BinaryDataWriter.$ctor1(o,!1);bw.ByteOrder=data.endianness;bw.Write$37("SARC",Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination);bw.Write$15(20);bw.Write$15(65279);bw.Write$16(0);bw.Write$16(0);bw.Write$15(256);bw.Write$15(0);bw.Write$37("SFAT",Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination);bw.Write$15(12);bw.Write$15(System.Array.getCount(data.Files.getKeys(),System.String)&65535);bw.Write$16(101);offsetToUpdate=new(System.Collections.Generic.List$1(System.UInt32).ctor);$t=Bridge.getEnumerator(data.Files.getKeys(),System.String);try{while($t.moveNext())k=$t.Current,data.HashOnly?bw.Write$16(SARCExt.SARC.StringHashToUint(k)):bw.Write$16(SARCExt.SARC.NameHash(k)),offsetToUpdate.add(System.Int64.clipu32(bw.BaseStream.Position)),bw.Write$16(0),bw.Write$16(0),bw.Write$16(0)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}bw.Write$37("SFNT",Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination);bw.Write$15(8);bw.Write$15(0);StringOffsets=new(System.Collections.Generic.List$1(System.UInt32).ctor);$t1=Bridge.getEnumerator(data.Files.getKeys(),System.String);try{while($t1.moveNext())k1=$t1.Current,StringOffsets.add(System.Int64.clipu32(bw.BaseStream.Position)),bw.Write$37(k1,Syroot.BinaryData.BinaryStringFormat.ZeroTerminated),bw.Align(4)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}bw.Align(4096);FileOffsets=new(System.Collections.Generic.List$1(System.UInt32).ctor);$t2=Bridge.getEnumerator(data.Files.getKeys(),System.String);try{while($t2.moveNext())k2=$t2.Current,bw.Align(SARCExt.SARC.GuessFileAlignment(data.Files.get(k2))|0),FileOffsets.add(System.Int64.clipu32(bw.BaseStream.Position)),bw.Write$2(data.Files.get(k2))}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$Dispose()}for(i=0;i<offsetToUpdate.Count;i=i+1|0)bw.BaseStream.Position=System.Int64(offsetToUpdate.getItem(i)),data.HashOnly?bw.Write$16(0):bw.Write$16((16777216|Bridge.Int.div(StringOffsets.getItem(i)-StringOffsets.getItem(0)>>>0,4)>>>0)>>>0),bw.Write$16(FileOffsets.getItem(i)-FileOffsets.getItem(0)>>>0),bw.Write$16(System.Int64.clipu32(System.Int64(FileOffsets.getItem(i)).add(System.Int64(($t3=System.Linq.Enumerable.from(data.Files.getValues()).ToArray())[i].length)).sub(System.Int64(FileOffsets.getItem(0)))));return bw.BaseStream.Position=System.Int64(8),bw.Write$16(System.Int64.clipu32(bw.BaseStream.Length)),bw.Write$16(FileOffsets.getItem(0)),{Item1:align,Item2:o.ToArray()}},UnpackRamN:function(src){return SARCExt.SARC.UnpackRamN$1(new System.IO.MemoryStream.$ctor1(src))},UnpackRamN$1:function(src){var $t,res=new(System.Collections.Generic.Dictionary$2(System.String,System.Array.type(System.Byte))),br=new Syroot.BinaryData.BinaryDataReader.$ctor1(src,!1),startingOff,sfat,sfnt,HashOnly,m,temp,tempInt;if(br.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian,br.BaseStream.Position=System.Int64(6),br.ReadUInt16()===65534&&(br.ByteOrder=Syroot.BinaryData.ByteOrder.BigEndian),br.BaseStream.Position=System.Int64(0),!Bridge.referenceEquals(br.ReadString$3(4),"SARC"))throw new System.Exception("Wrong magic");for(br.ReadUInt16(),br.ReadUInt16(),br.ReadUInt32(),startingOff=br.ReadUInt32(),br.ReadUInt32(),sfat=new SARCExt.SARC.SFAT,sfat.parse(br,System.Int64.clip32(br.BaseStream.Position)),sfnt=new SARCExt.SARC.SFNT,sfnt.parse(br,System.Int64.clip32(br.BaseStream.Position),sfat,startingOff|0),HashOnly=!1,sfat.nodeCount>0&&sfat.nodes.getItem(0).$clone().fileBool!==1&&(HashOnly=!0),m=0;m<sfat.nodeCount;m=m+1|0)br.Seek$1(System.Int64(sfat.nodes.getItem(m).$clone().nodeOffset+startingOff),0),m===0?temp=br.ReadBytes(sfat.nodes.getItem(m).$clone().EON|0):(tempInt=(sfat.nodes.getItem(m).$clone().EON|0)-(sfat.nodes.getItem(m).$clone().nodeOffset|0)|0,temp=br.ReadBytes(tempInt)),sfat.nodes.getItem(m).$clone().fileBool===1?res.add(sfnt.fileNames.getItem(m),temp):res.add((System.UInt32.format(sfat.nodes.getItem(m).$clone().hash,"X8")||"")+(SARCExt.SARC.GuessFileExtension(temp)||""),temp);return $t=new SARCExt.SarcData,$t.endianness=br.ByteOrder,$t.HashOnly=HashOnly,$t.Files=res,$t},pack:function(files,align,endianness){var $t;return align===void 0&&(align=-1),endianness===void 0&&(endianness=65534),SARCExt.SARC.PackN(($t=new SARCExt.SarcData,$t.Files=files,$t.endianness=endianness,$t.HashOnly=!1,$t),align).Item2},UnpackRam:function(src){return SARCExt.SARC.UnpackRamN$1(new System.IO.MemoryStream.$ctor1(src)).Files},UnpackRam$1:function(src){return SARCExt.SARC.UnpackRamN$1(src).Files}}}});Bridge.define("SARCExt.SARC.SFAT",{$kind:"nested class",fields:{nodes:null,chunkSize:0,nodeCount:0,hashMultiplier:0},ctors:{init:function(){this.nodes=new(System.Collections.Generic.List$1(SARCExt.SARC.SFAT.Node).ctor)}},methods:{parse:function(br,pos){var i,node,attributes;for(br.ReadUInt32(),this.chunkSize=br.ReadUInt16(),this.nodeCount=br.ReadUInt16(),this.hashMultiplier=br.ReadUInt32(),i=0;i<this.nodeCount;i=i+1|0)node=new SARCExt.SARC.SFAT.Node,node.hash=br.ReadUInt32(),attributes=br.ReadUInt32(),node.fileBool=attributes>>>24&255,node.unknown1=(attributes>>>16&255)>>>0&255,node.fileNameOffset=(attributes&65535)>>>0&65535,node.nodeOffset=br.ReadUInt32(),node.EON=br.ReadUInt32(),this.nodes.add(node.$clone())}}});Bridge.define("SARCExt.SARC.SFAT.Node",{$kind:"nested struct",statics:{methods:{getDefaultValue:function(){return new SARCExt.SARC.SFAT.Node}}},fields:{hash:0,fileBool:0,unknown1:0,fileNameOffset:0,nodeOffset:0,EON:0},ctors:{ctor:function(){this.$initialize()}},methods:{getHashCode:function(){return Bridge.addHash([1701080910,this.hash,this.fileBool,this.unknown1,this.fileNameOffset,this.nodeOffset,this.EON])},equals:function(o){return Bridge.is(o,SARCExt.SARC.SFAT.Node)?Bridge.equals(this.hash,o.hash)&&Bridge.equals(this.fileBool,o.fileBool)&&Bridge.equals(this.unknown1,o.unknown1)&&Bridge.equals(this.fileNameOffset,o.fileNameOffset)&&Bridge.equals(this.nodeOffset,o.nodeOffset)&&Bridge.equals(this.EON,o.EON):!1},$clone:function(to){var s=to||new SARCExt.SARC.SFAT.Node;return s.hash=this.hash,s.fileBool=this.fileBool,s.unknown1=this.unknown1,s.fileNameOffset=this.fileNameOffset,s.nodeOffset=this.nodeOffset,s.EON=this.EON,s}}});Bridge.define("SARCExt.SARC.SFNT",{$kind:"nested class",fields:{fileNames:null,chunkID:0,chunkSize:0,unknown1:0},ctors:{init:function(){this.fileNames=new(System.Collections.Generic.List$1(System.String).ctor)}},methods:{parse:function(br,pos,sfat,start){var j;this.chunkID=br.ReadUInt32();this.chunkSize=br.ReadUInt16();this.unknown1=br.ReadUInt16();var temp=br.ReadChars(start-System.Int64.clip32(br.BaseStream.Position)|0),temp2=System.String.fromCharArray(temp),splitter=System.Array.init([0],System.Char),names=System.String.split(temp2,splitter.map(function(i){return String.fromCharCode(i)}));for(j=0;j<names.length;j=j+1|0)Bridge.referenceEquals(names[j],"")||this.fileNames.add(names[j])}}});Bridge.define("SARCExt.SarcData",{fields:{Files:null,endianness:0,HashOnly:!1}});Bridge.define("SwitchThemes.Common.BflytFile",{statics:{methods:{TryGetPanelName:function(p){var dataReader,PanelName,i,c;if(p.data.length<28)return null;for(dataReader=new Syroot.BinaryData.BinaryDataReader.$ctor3(new System.IO.MemoryStream.$ctor1(p.data),System.Text.Encoding.ASCII,!1),dataReader.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian,dataReader.ReadInt32(),PanelName="",i=0;i<24;i=i+1|0){if(c=dataReader.ReadChar(),c===0)break;PanelName=(PanelName||"")+String.fromCharCode(c)}return PanelName}}},fields:{Panels:null,version:0},props:{GetTex:{get:function(){var res=Bridge.cast(this.Panels.Find(function(x){return Bridge.is(x,SwitchThemes.Common.BflytFile.TextureSection)}),SwitchThemes.Common.BflytFile.TextureSection);return res==null&&(res=new SwitchThemes.Common.BflytFile.TextureSection.ctor,this.Panels.insert(2,res)),res}},GetMat:{get:function(){var res=Bridge.cast(this.Panels.Find(function(x){return Bridge.is(x,SwitchThemes.Common.BflytFile.MaterialsSection)}),SwitchThemes.Common.BflytFile.MaterialsSection);return res==null&&(res=new SwitchThemes.Common.BflytFile.MaterialsSection.ctor,this.Panels.insert(3,res)),res}}},ctors:{init:function(){this.Panels=new(System.Collections.Generic.List$1(SwitchThemes.Common.BflytFile.BasePanel).ctor)},ctor:function(data){SwitchThemes.Common.BflytFile.$ctor1.call(this,new System.IO.MemoryStream.$ctor1(data))},$ctor1:function(file){var bin,sectionCount,i,name;if(this.$initialize(),bin=new Syroot.BinaryData.BinaryDataReader.ctor(file),bin.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian,!Bridge.referenceEquals(bin.ReadString$3(4),"FLYT"))throw new System.Exception("Wrong signature");for(bin.ReadUInt16(),bin.ReadUInt16(),this.version=bin.ReadUInt32(),bin.ReadUInt32(),sectionCount=bin.ReadUInt16(),bin.ReadUInt16(),i=0;i<sectionCount;i=i+1|0){name=bin.ReadString$3(4);switch(name){case"txl1":this.Panels.add(new SwitchThemes.Common.BflytFile.TextureSection.$ctor1(bin));break;case"mat1":this.Panels.add(new SwitchThemes.Common.BflytFile.MaterialsSection.$ctor1(bin));break;case"pic1":this.Panels.add(new SwitchThemes.Common.BflytFile.PicturePanel(bin));break;default:this.Panels.add(new SwitchThemes.Common.BflytFile.BasePanel.$ctor1(name,bin));break}if(i===(sectionCount-1|0)&&bin.BaseStream.Position.ne(bin.BaseStream.Length)){while(bin.PeekChar()===0&&bin.BaseStream.Position.lt(bin.BaseStream.Length))bin.ReadChar();bin.BaseStream.Length.sub(bin.BaseStream.Position).gte(System.Int64(8))&&(sectionCount=sectionCount+1&65535)}}}},methods:{getItem:function(index){return this.Panels.getItem(index)},setItem:function(index,value){this.Panels.setItem(index,value)},SaveFile:function(){var $t,res=new System.IO.MemoryStream.ctor,bin=new Syroot.BinaryData.BinaryDataWriter.ctor(res),p;bin.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian;bin.Write$37("FLYT",Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination);bin.Write$1(255);bin.Write$1(254);bin.Write$15(20);bin.Write$16(this.version);bin.Write$10(0);bin.Write$15(this.Panels.Count&65535);bin.Write$15(0);$t=Bridge.getEnumerator(this.Panels);try{while($t.moveNext())p=$t.Current,p.WritePanel(bin)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}while(bin.BaseStream.Position.mod(System.Int64(4)).ne(System.Int64(0)))bin.Write$1(0);return bin.BaseStream.Position=System.Int64(12),bin.Write$16(System.Int64.clipu32(bin.BaseStream.Length)),bin.BaseStream.Position=bin.BaseStream.Length,res.ToArray()},PatchTextureName:function(original,_new){for(var texSection=this.GetTex,i=0;i<texSection.Textures.Count;i=i+1|0)Bridge.referenceEquals(texSection.Textures.getItem(i),original)&&texSection.Textures.setItem(i,_new)},AddBgPanel:function(index,TexName,Pic1Name){var BgPanel,zerCount,texSection;if(Pic1Name.length>24)throw new System.Exception("Pic1Name should not be longer than 24 chars");BgPanel=new SwitchThemes.Common.BflytFile.BasePanel.$ctor2("pic1",8);this.Panels.insert(index,BgPanel);var MatSect=this.GetMat,strm=new System.IO.MemoryStream.ctor,bin=new Syroot.BinaryData.BinaryDataWriter.ctor(strm);try{for(bin.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian,bin.Write$1(1),bin.Write$1(0),bin.Write$1(255),bin.Write$1(4),bin.Write$37(Pic1Name,Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination),zerCount=Pic1Name.length;Bridge.identity(zerCount,zerCount=zerCount+1|0)<56;)bin.Write$1(0);bin.Write$13(1);bin.Write$13(1);bin.Write$13(1280);bin.Write$13(720);bin.Write$16(4294967295);bin.Write$16(4294967295);bin.Write$16(4294967295);bin.Write$16(4294967295);bin.Write$15(MatSect.Materials.Count&65535);bin.Write$15(1);bin.Write$16(0);bin.Write$16(0);bin.Write$13(1);bin.Write$16(0);bin.Write$16(0);bin.Write$13(1);bin.Write$13(1);bin.Write$13(1);BgPanel.data=strm.ToArray()}finally{Bridge.hasValue(bin)&&bin.System$IDisposable$Dispose()}texSection=this.GetTex;texSection.Textures.contains(TexName)||texSection.Textures.add(TexName);var texIndex=texSection.Textures.indexOf(TexName),mem=new System.IO.MemoryStream.ctor,bin1=new Syroot.BinaryData.BinaryDataWriter.ctor(mem);try{bin1.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian;bin1.Write$37("P_Custm",Syroot.BinaryData.BinaryStringFormat.ZeroTerminated);bin1.Write$2(System.Array.init(20,0,System.Byte));bin1.Write$10(21);bin1.Write$10(134480384);bin1.Write$10(0);bin1.Write$16(4294967295);bin1.Write$15(texIndex&65535);bin1.Write$15(0);bin1.Write$2(System.Array.init(12,0,System.Byte));bin1.Write$13(1);bin1.Write$13(1);bin1.Write$2(System.Array.init(16,0,System.Byte));MatSect.Materials.add(mem.ToArray())}finally{Bridge.hasValue(bin1)&&bin1.System$IDisposable$Dispose()}return SwitchThemes.Common.BflytFile.PatchResult.OK},GetPaneNames:function(){for(var paneNames=System.Array.init(this.Panels.Count,null,System.String),i=0;i<this.Panels.Count;i=i+1|0)paneNames[i]=SwitchThemes.Common.BflytFile.TryGetPanelName(this.Panels.getItem(i));return paneNames},ApplyLayoutPatch:function(Patches){for(var index,p,e,$t,$t1,$t2,$t3,$t4,$t5,$t6,$t7,$t8,$t9,paneNames=this.GetPaneNames(),i=0;i<Patches.length;i=i+1|0){if(index=System.Array.indexOfT(paneNames,Patches[i].PaneName),index===-1)return SwitchThemes.Common.BflytFile.PatchResult.CorruptedFile;p=Patches[i];e=new SwitchThemes.Common.BflytFile.PropertyEditablePanel(this.Panels.getItem(index));this.Panels.setItem(index,e);p.Visible!=null&&(e.Visible=System.Nullable.getValue(p.Visible));p.Position!=null&&(e.Position.X=($t=System.Nullable.getValue(p.Position).X,$t!=null?$t:e.Position.X),e.Position.Y=($t1=System.Nullable.getValue(p.Position).Y,$t1!=null?$t1:e.Position.Y),e.Position.Z=($t2=System.Nullable.getValue(p.Position).Z,$t2!=null?$t2:e.Position.Z));p.Rotation!=null&&(e.Rotation.X=($t3=System.Nullable.getValue(p.Rotation).X,$t3!=null?$t3:e.Rotation.X),e.Rotation.Y=($t4=System.Nullable.getValue(p.Rotation).Y,$t4!=null?$t4:e.Rotation.Y),e.Rotation.Z=($t5=System.Nullable.getValue(p.Rotation).Z,$t5!=null?$t5:e.Rotation.Z));p.Scale!=null&&(e.Scale.X=($t6=System.Nullable.getValue(p.Scale).X,$t6!=null?$t6:e.Scale.X),e.Scale.Y=($t7=System.Nullable.getValue(p.Scale).Y,$t7!=null?$t7:e.Scale.Y));p.Size!=null&&(e.Size.X=($t8=System.Nullable.getValue(p.Size).X,$t8!=null?$t8:e.Size.X),e.Size.Y=($t9=System.Nullable.getValue(p.Size).Y,$t9!=null?$t9:e.Size.Y));Bridge.referenceEquals(e.name,"pic1")&&(p.ColorTL!=null&&(e.ColorData[0]=System.Convert.toNumberInBase(p.ColorTL,16,10)),p.ColorTR!=null&&(e.ColorData[1]=System.Convert.toNumberInBase(p.ColorTR,16,10)),p.ColorBL!=null&&(e.ColorData[2]=System.Convert.toNumberInBase(p.ColorBL,16,10)),p.ColorBR!=null&&(e.ColorData[3]=System.Convert.toNumberInBase(p.ColorBR,16,10)))}return SwitchThemes.Common.BflytFile.PatchResult.OK},PatchBgLayout:function(patch){for(var p,target,i1,name,bin,i=0;i<this.Panels.Count;i=i+1|0)if(Bridge.is(this.Panels.getItem(i),SwitchThemes.Common.BflytFile.PicturePanel)){if(p=Bridge.as(this.Panels.getItem(i),SwitchThemes.Common.BflytFile.PicturePanel),Bridge.referenceEquals(p.PanelName,patch.PatchIdentifier))return SwitchThemes.Common.BflytFile.PatchResult.AlreadyPatched;Bridge.referenceEquals(p.PanelName,"3x3lxBG")&&(this.Panels.remove(p),this.GetTex.Textures.setItem(0,"White1x1^r"),this.GetMat.Materials.removeAt(1))}for(target=2147483647,i1=0;i1<(this.Panels.Count-1|0);i1=i1+1|0)if(name=SwitchThemes.Common.BflytFile.TryGetPanelName(this.Panels.getItem(i1)),name!=null&&System.Array.contains(patch.targetPanels,name,System.String)&&(i1<target&&(target=i1),!patch.NoRemovePanel)){bin=new Syroot.BinaryData.BinaryDataWriter.ctor(new System.IO.MemoryStream.$ctor1(this.Panels.getItem(i1).data));try{bin.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian;bin.BaseStream.Position=System.Int64(36);bin.Write$13(5e3);bin.Write$13(6e4);this.Panels.getItem(i1).data=Bridge.cast(bin.BaseStream,System.IO.MemoryStream).ToArray()}finally{Bridge.hasValue(bin)&&bin.System$IDisposable$Dispose()}}return target===2147483647?SwitchThemes.Common.BflytFile.PatchResult.Fail:this.AddBgPanel(target,patch.MaintextureName,patch.PatchIdentifier)}}});Bridge.define("SwitchThemes.Common.BflytFile.BasePanel",{$kind:"nested class",fields:{name:null,length:0,data:null},ctors:{$ctor2:function(_name,len){this.$initialize();this.name=_name;this.length=len;this.data=System.Array.init(this.length-8|0,0,System.Byte)},ctor:function(basePane){this.$initialize();this.name=basePane.name;this.length=basePane.length;this.data=basePane.data},$ctor1:function(_name,bin){this.$initialize();this.name=_name;this.length=bin.ReadInt32();this.data=bin.ReadBytes(this.length-8|0)}},methods:{toString:function(){return System.String.format("Panel {0} len: 0x{1}",this.name,System.Int32.format(this.length,"X"))},WritePanel:function(bin){bin.Write$37(this.name,Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination);this.length=this.data.length+8|0;bin.Write$10(this.length);bin.Write$2(this.data)}}});Bridge.define("SwitchThemes.Common.BflytFile.PatchResult",{$kind:"nested enum",statics:{fields:{AlreadyPatched:0,Fail:1,CorruptedFile:2,OK:3}}});Bridge.define("SwitchThemes.Common.Bntxx.ChannelType",{$kind:"enum",statics:{fields:{Zero:0,One:1,Red:2,Green:3,Blue:4,Alpha:5}}});Bridge.define("SwitchThemes.Common.Bntxx.DDSEncoder",{statics:{methods:{EncodeTex:function(img){for(var offSize,data,pitch,numMips=1,alignment=512,blkWidth=4,blkHeight=4,bpp=8,blockHeight=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.getBlockHeight(SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(img.height,blkHeight)),blockHeightLog2=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.Log2(blockHeight),linesPerBlockHeight=Bridge.Int.mul(blockHeight,8),surfSize=0,blockHeightShift=0,mipOfsets=new(System.Collections.Generic.List$1(System.Int32).ctor),res=new(System.Collections.Generic.List$1(System.Byte).ctor),mipLevel=0;mipLevel<numMips;mipLevel=mipLevel+1|0){offSize=SwitchThemes.Common.Bntxx.DDSEncoder.getCurrentMipOffset_Size(img.width,img.height,blkWidth,blkHeight,bpp,mipLevel);data=System.Array.init(offSize.Item2,0,System.Byte);System.Array.copy(img.data,offSize.Item1,data,0,offSize.Item2);var width_=Math.max(1,img.width>>mipLevel),height_=Math.max(1,img.height>>mipLevel),width__=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(width_,blkWidth),height__=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(height_,blkHeight),dataAlignBytes=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.round_up(surfSize,alignment)-surfSize|0;surfSize=surfSize+dataAlignBytes|0;mipOfsets.add(surfSize);SwitchThemes.Common.Bntxx.DDSEncoder.Utils.pow2_round_up(height__)<linesPerBlockHeight&&(blockHeightShift=blockHeightShift+1|0);pitch=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.round_up(Bridge.Int.mul(width__,bpp),64);surfSize=surfSize+Bridge.Int.mul(pitch,SwitchThemes.Common.Bntxx.DDSEncoder.Utils.round_up(height__,Bridge.Int.mul(Math.max(1,blockHeight>>blockHeightShift),8)))|0;dataAlignBytes!==0&&res.AddRange(System.Array.init(dataAlignBytes,0,System.Byte));res.AddRange(SwitchThemes.Common.Bntxx.DDSEncoder.Swizzle.swizzle(width_,height_,blkWidth,blkHeight,!0,bpp,0,Math.max(0,blockHeightLog2-blockHeightShift|0),data,!0))}return res.ToArray()},getCurrentMipOffset_Size:function(width,height,blkWidth,blkHeight,bpp,currLevel){for(var size,offset=0,width_=0,height_=0,mipLevel=0;mipLevel<currLevel;mipLevel=mipLevel+1|0)width_=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(Math.max(1,width>>mipLevel),blkWidth),height_=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(Math.max(1,height>>mipLevel),blkHeight),offset=offset+Bridge.Int.mul(Bridge.Int.mul(width_,height_),bpp)|0;return width_=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(Math.max(1,width>>currLevel),blkWidth),height_=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(Math.max(1,height>>currLevel),blkHeight),size=Bridge.Int.mul(Bridge.Int.mul(width_,height_),bpp),{Item1:offset,Item2:size}},LoadDDS:function(inb){var $t;if(!(inb[84]===68&&inb[85]===88&&inb[86]===84&&inb[87]===49))throw new System.Exception("Unsupported format : only DXT1 encoding is supported for DDS");var format_=6662,bpp=8,width=System.BitConverter.toInt32(inb,16),height=System.BitConverter.toInt32(inb,12),size=Bridge.Int.mul(Bridge.Int.mul((width+3|0)>>2,(height+3|0)>>2),bpp),numMips=0,mipSize=0,res=System.Array.init(size+mipSize|0,0,System.Byte);return System.Array.copy(inb,128,res,0,size+mipSize|0),$t=new SwitchThemes.Common.Bntxx.DDSEncoder.DDSLoadResult,$t.width=width,$t.height=height,$t.format_=format_,$t.fourcc="DXT1",$t.size=size,$t.compSel=System.Array.init([2,3,4,5],System.Int32),$t.numMips=numMips,$t.data=res,$t}}}});Bridge.define("SwitchThemes.Common.Bntxx.DDSEncoder.DDSLoadResult",{$kind:"nested class",fields:{width:0,height:0,format_:0,fourcc:null,size:0,compSel:null,numMips:0,data:null}});Bridge.define("SwitchThemes.Common.Bntxx.DDSEncoder.Swizzle",{$kind:"nested class",statics:{methods:{getAddrBlockLinear:function(x,y,image_width,bytes_per_pixel,base_address,blockHeight){var image_width_in_gobs=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(Bridge.Int.mul(image_width,bytes_per_pixel),64),GOB_address=((base_address+Bridge.Int.mul(Bridge.Int.mul(Bridge.Int.mul(Bridge.Int.div(y,Bridge.Int.mul(8,blockHeight))|0,512),blockHeight),image_width_in_gobs)|0)+Bridge.Int.mul(Bridge.Int.mul(Bridge.Int.div(Bridge.Int.mul(x,bytes_per_pixel),64)|0,512),blockHeight)|0)+Bridge.Int.mul(Bridge.Int.div(y%Bridge.Int.mul(8,blockHeight),8)|0,512)|0;return x=Bridge.Int.mul(x,bytes_per_pixel),((((GOB_address+Bridge.Int.mul(Bridge.Int.div(x%64,32)|0,256)|0)+Bridge.Int.mul(Bridge.Int.div(y%8,2)|0,64)|0)+Bridge.Int.mul(Bridge.Int.div(x%32,16)|0,32)|0)+Bridge.Int.mul(y%2,16)|0)+x%16|0},swizzle:function(width,height,blkWidth,blkHeight,roundPitch,bpp,tileMode,blockHeightLog2,data,toSwizzle){var blockHeight=1<<blockHeightLog2,pitch,surfSize,res,y,x,pos,pos_;for(width=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(width,blkWidth),height=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.DIV_ROUND_UP(height,blkHeight),pitch=-1,surfSize=-1,tileMode===1?(pitch=Bridge.Int.mul(width,bpp),roundPitch&&(pitch=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.round_up(pitch,32)),surfSize=Bridge.Int.mul(pitch,height)):(pitch=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.round_up(Bridge.Int.mul(width,bpp),64),surfSize=Bridge.Int.mul(pitch,SwitchThemes.Common.Bntxx.DDSEncoder.Utils.round_up(height,Bridge.Int.mul(blockHeight,8)))),res=System.Array.init(surfSize,0,System.Byte),y=0;y<height;y=y+1|0)for(x=0;x<width;x=x+1|0)pos=-1,pos=tileMode===1?Bridge.Int.mul(y,pitch)+Bridge.Int.mul(x,bpp)|0:SwitchThemes.Common.Bntxx.DDSEncoder.Swizzle.getAddrBlockLinear(x,y,width,bpp,0,blockHeight),pos_=Bridge.Int.mul(Bridge.Int.mul(y,width)+x|0,bpp),(pos+bpp|0)<=surfSize&&(toSwizzle?System.Array.copy(data,pos_,res,pos,bpp):System.Array.copy(data,pos,res,pos_,bpp));return res}}}});Bridge.define("SwitchThemes.Common.Bntxx.DDSEncoder.Utils",{$kind:"nested class",statics:{methods:{DIV_ROUND_UP:function(n,d){return Bridge.Int.div((n+d|0)-1|0,d)|0},round_up:function(x,y){return(x-1|0|y-1|0)+1|0},pow2_round_up:function(x){return x=x-1|0,x=x|x>>1,x=x|x>>2,x=x|x>>4,x=x|x>>8,x=x|x>>16,x+1|0},Log2:function(v){var r=(65535-v|0)>>31&16,shift;return v=v>>r,shift=(255-v|0)>>31&8,v=v>>shift,r=r|shift,shift=(15-v|0)>>31&4,v=v>>shift,r=r|shift,shift=(3-v|0)>>31&2,v=v>>shift,r=r|shift,r|v>>1},getBlockHeight:function(height){var blockHeight=SwitchThemes.Common.Bntxx.DDSEncoder.Utils.pow2_round_up(Bridge.Int.div(height,8)|0);return blockHeight>16&&(blockHeight=16),blockHeight}}}});Bridge.define("SwitchThemes.Common.Bntxx.QuickBntx",{fields:{Textures:null,Head:null,Rlt:null},ctors:{init:function(){this.Textures=new(System.Collections.Generic.List$1(SwitchThemes.Common.Bntxx.Texture).ctor)},ctor:function(Reader){var FirstBrti,Index;if(this.$initialize(),!Bridge.referenceEquals(Reader.ReadString$3(4),"BNTX"))throw new System.Exception("Wrong magic");Reader.ReadInt32();var DataLength=Reader.ReadInt32(),ByteOrderMark=Reader.ReadUInt16(),FormatRevision=Reader.ReadUInt16(),NameAddress=Reader.ReadInt32(),StringsAddress=Reader.ReadInt32()>>16,RelocAddress=Reader.ReadInt32(),FileLength=Reader.ReadInt32();if(!Bridge.referenceEquals(Reader.ReadString$3(4),"NX  "))throw new System.Exception("Wrong magic");var TexturesCount=Reader.ReadUInt32(),InfoPtrsAddress=Reader.ReadInt64(),DataBlkAddress=Reader.ReadInt64(),DictAddress=Reader.ReadInt64(),StrDictLength=Reader.ReadUInt32();for(Reader.BaseStream.Seek(InfoPtrsAddress,0),FirstBrti=System.Int64.clip32(Reader.ReadInt64()),Reader.BaseStream.Position=System.Int64(0),this.Head=Reader.ReadBytes(FirstBrti),Index=0;System.Int64(Index).lt(System.Int64(TexturesCount));Index=Index+1|0)Reader.BaseStream.Seek(InfoPtrsAddress.add(System.Int64(Bridge.Int.mul(Index,8))),0),Reader.BaseStream.Seek(Reader.ReadInt64(),0),this.Textures.add(new SwitchThemes.Common.Bntxx.Texture(Reader));Reader.BaseStream.Position=System.Int64(RelocAddress);this.Rlt=Reader.ReadBytes(System.Int64.clip32(Reader.BaseStream.Length)-System.Int64.clip32(Reader.BaseStream.Position)|0)}},methods:{ReplaceTex$1:function(texName,DDS){var dds=SwitchThemes.Common.Bntxx.DDSEncoder.LoadDDS(DDS);this.ReplaceTex(texName,dds)},ReplaceTex:function(texName,dds){var target=System.Linq.Enumerable.from(this.Textures).where(function(x){return Bridge.referenceEquals(x.Name,texName)}).first();target.Data=SwitchThemes.Common.Bntxx.DDSEncoder.EncodeTex(dds);target.TextureType=SwitchThemes.Common.Bntxx.TextureType.Image2D;target.Format=6657;target.ChannelTypes=84148994;target.Width=dds.width;target.Height=dds.height;target.TileMode=0;target.SwizzleSize=0;target.Reversed1A=0;target.Reserved4C=0;target.Reserved48=0;target.Reserved44=0;target.Reserved40=0;target.Reserved3C=0;target.Reserved38=65543;target.MipmapCount=1;target.Flags=1;target.Depth=1;target.BlockHeightLog2=4;target.Alignment=512;target.AccessFlags=32},Write:function(){var $t,$t1,mem=new System.IO.MemoryStream.ctor,bin=new Syroot.BinaryData.BinaryDataWriter.ctor(mem),TexPositions,t,DataStart,TexDataPositions,t1,rltPos,i;bin.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian;bin.Write$2(this.Head);TexPositions=new(System.Collections.Generic.List$1(System.Int64).ctor);$t=Bridge.getEnumerator(this.Textures);try{while($t.moveNext())t=$t.Current,TexPositions.add(bin.BaseStream.Position),bin.Write$2(t.Write())}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}DataStart=bin.BaseStream.Position;TexDataPositions=new(System.Collections.Generic.List$1(System.Int64).ctor);bin.Align(16);bin.Write$37("BRTD",Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination);bin.Write$10(0);bin.Write$10(0);bin.Write$10(0);$t1=Bridge.getEnumerator(this.Textures);try{while($t1.moveNext())t1=$t1.Current,TexDataPositions.add(bin.BaseStream.Position),bin.Write$2(t1.Data),bin.Align(16)}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}for(bin.Align(4096),rltPos=System.Int64.clipu32(bin.BaseStream.Position),bin.Write$2(this.Rlt),bin.BaseStream.Position=System.Int64(24),bin.Write$16(rltPos),bin.Write$16(System.Int64.clipu32(bin.BaseStream.Length)),bin.BaseStream.Position=TexDataPositions.getItem(0).sub(System.Int64(8)),bin.Write$11(System.Int64(rltPos).sub(TexDataPositions.getItem(0).sub(System.Int64(16)))),i=0;i<TexPositions.Count;i=i+1|0)bin.BaseStream.Position=TexPositions.getItem(i).add(System.Int64(672)),bin.Write$11(TexDataPositions.getItem(i));return bin.BaseStream.Position=System.Int64(rltPos+4),bin.Write$16(rltPos),mem.ToArray()}}});Bridge.define("SwitchThemes.Common.Bntxx.Texture",{fields:{BRTILength0:0,BRTILength1:System.Int64(0),Flags:0,Dimensions:0,TileMode:0,SwizzleSize:0,MipmapCount:0,MultiSampleCount:0,Reversed1A:0,Format:0,AccessFlags:0,Width:0,Height:0,Depth:0,ArrayCount:0,BlockHeightLog2:0,Reserved38:0,Reserved3C:0,Reserved40:0,Reserved44:0,Reserved48:0,Reserved4C:0,DataLength:0,Alignment:0,ChannelTypes:0,TextureType:0,NameAddress:System.Int64(0),ParentAddress:System.Int64(0),PtrsAddress:System.Int64(0),Data:null,ExtraBrtiData:null,Name:null},props:{Channel0Type:{get:function(){return this.ChannelTypes>>0&255}},Channel3Type:{get:function(){return this.ChannelTypes>>8&255}},Channel1Type:{get:function(){return this.ChannelTypes>>16&255}},Channel2Type:{get:function(){return this.ChannelTypes>>24&255}},Type:{get:function(){return this.TextureType}},FormatType:{get:function(){return(this.Format>>>8&255)>>>0|0}},FormatVariant:{get:function(){return(this.Format>>>0&255)>>>0|0}}},ctors:{ctor:function(Reader){var startPos,MipOffsets,BaseOffset,Mip;if(this.$initialize(),startPos=Reader.BaseStream.Position,!Bridge.referenceEquals(Reader.ReadString$3(4),"BRTI"))throw new System.Exception("Wrong magic");for(this.BRTILength0=Reader.ReadInt32(),this.BRTILength1=Reader.ReadInt64(),this.Flags=Reader.ReadByte(),this.Dimensions=Reader.ReadByte(),this.TileMode=Reader.ReadUInt16(),this.SwizzleSize=Reader.ReadUInt16(),this.MipmapCount=Reader.ReadUInt16(),this.MultiSampleCount=Reader.ReadUInt16(),this.Reversed1A=Reader.ReadUInt16(),this.Format=Reader.ReadUInt32(),this.AccessFlags=Reader.ReadUInt32(),this.Width=Reader.ReadInt32(),this.Height=Reader.ReadInt32(),this.Depth=Reader.ReadInt32(),this.ArrayCount=Reader.ReadInt32(),this.BlockHeightLog2=Reader.ReadInt32(),this.Reserved38=Reader.ReadInt32(),this.Reserved3C=Reader.ReadInt32(),this.Reserved40=Reader.ReadInt32(),this.Reserved44=Reader.ReadInt32(),this.Reserved48=Reader.ReadInt32(),this.Reserved4C=Reader.ReadInt32(),this.DataLength=Reader.ReadInt32(),this.Alignment=Reader.ReadInt32(),this.ChannelTypes=Reader.ReadInt32(),this.TextureType=Reader.ReadInt32(),this.NameAddress=Reader.ReadInt64(),this.ParentAddress=Reader.ReadInt64(),this.PtrsAddress=Reader.ReadInt64(),this.ExtraBrtiData=Reader.ReadBytes(System.Int64.clip32(this.BRTILength1.sub(Reader.BaseStream.Position.sub(startPos)))),Reader.BaseStream.Seek(this.NameAddress,0),this.Name=Reader.ReadString$1(Syroot.BinaryData.BinaryStringFormat.WordLengthPrefix),MipOffsets=System.Array.init(this.MipmapCount,System.Int64(0),System.Int64),Reader.BaseStream.Seek(this.PtrsAddress,0),BaseOffset=Reader.ReadInt64(),Mip=1;Mip<this.MipmapCount;Mip=Mip+1|0)throw new System.Exception("mipmaps are not supported");Reader.BaseStream.Seek(BaseOffset,0);this.Data=Reader.ReadBytes(this.DataLength)}},methods:{Write:function(){var mem=new System.IO.MemoryStream.ctor,bin=new Syroot.BinaryData.BinaryDataWriter.ctor(mem);return bin.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian,bin.Write$37("BRTI",Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination),bin.Write$10(this.BRTILength0),bin.Write$11(this.BRTILength1),bin.Write$1(this.Flags),bin.Write$1(this.Dimensions),bin.Write$15(this.TileMode),bin.Write$15(this.SwizzleSize),bin.Write$15(this.MipmapCount),bin.Write$15(this.MultiSampleCount),bin.Write$15(this.Reversed1A),bin.Write$16(this.Format),bin.Write$16(this.AccessFlags),bin.Write$10(this.Width),bin.Write$10(this.Height),bin.Write$10(this.Depth),bin.Write$10(this.ArrayCount),bin.Write$10(this.BlockHeightLog2),bin.Write$10(this.Reserved38),bin.Write$10(this.Reserved3C),bin.Write$10(this.Reserved40),bin.Write$10(this.Reserved44),bin.Write$10(this.Reserved48),bin.Write$10(this.Reserved4C),bin.Write$10(this.Data.length),bin.Write$10(this.Alignment),bin.Write$10(this.ChannelTypes),bin.Write$10(this.TextureType),bin.Write$11(this.NameAddress),bin.Write$11(this.ParentAddress),bin.Write$11(this.PtrsAddress),bin.Write$2(this.ExtraBrtiData),mem.ToArray()}}});Bridge.define("SwitchThemes.Common.Bntxx.TextureFormatType",{$kind:"enum",statics:{fields:{R5G6B5:7,R8G8:9,R16:10,R8G8B8A8:11,R11G11B10:15,R32:20,BC1:26,BC2:27,BC3:28,BC4:29,BC5:30,ASTC4x4:45,ASTC5x4:46,ASTC5x5:47,ASTC6x5:48,ASTC6x6:49,ASTC8x5:50,ASTC8x6:51,ASTC8x8:52,ASTC10x5:53,ASTC10x6:54,ASTC10x8:55,ASTC10x10:56,ASTC12x10:57,ASTC12x12:58}}});Bridge.define("SwitchThemes.Common.Bntxx.TextureFormatVar",{$kind:"enum",statics:{fields:{UNorm:1,SNorm:2,UInt:3,SInt:4,Single:5,SRGB:6,UHalf:10}}});Bridge.define("SwitchThemes.Common.Bntxx.TextureType",{$kind:"enum",statics:{fields:{Image1D:0,Image2D:1,Image3D:2,Cube:3,CubeFar:8}}});Bridge.define("SwitchThemes.Common.DefaultTemplates",{statics:{fields:{templates:null},ctors:{init:function(){var $t;this.templates=System.Array.init([($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="home and applets",$t.szsName="common.szs",$t.TitleId="0100000000001000",$t.FirmName="<= 5.X",$t.FnameIdentifier=System.Array.init([],System.String),$t.FnameNotIdentifier=System.Array.init(["blyt/DHdrSoft.bflyt"],System.String),$t.MainLayoutName="blyt/BgNml.bflyt",$t.MaintextureName="White1x1_180^r",$t.PatchIdentifier="exelixBG",$t.targetPanels=System.Array.init(["P_Bg_00"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/SystemAppletFader.bflyt"],System.String),$t.SecondaryTexReplace="White1x1^r",$t.NXThemeName="home",$t),($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="home menu",$t.szsName="ResidentMenu.szs",$t.TitleId="0100000000001000",$t.FirmName="6.X",$t.FnameIdentifier=System.Array.init([],System.String),$t.FnameNotIdentifier=System.Array.init(["anim/RdtBtnShop_LimitB.bflan"],System.String),$t.MainLayoutName="blyt/BgNml.bflyt",$t.MaintextureName="White1x1A128^s",$t.PatchIdentifier="exelixBG",$t.targetPanels=System.Array.init(["P_Bg_00"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/IconError.bflyt"],System.String),$t.SecondaryTexReplace="White1x1A64^t",$t.NXThemeName="home",$t),($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="lock screen",$t.szsName="Entrance.szs",$t.TitleId="0100000000001000",$t.FirmName="all firmwares",$t.FnameIdentifier=System.Array.init([],System.String),$t.FnameNotIdentifier=System.Array.init([],System.String),$t.MainLayoutName="blyt/EntMain.bflyt",$t.MaintextureName="White1x1^s",$t.PatchIdentifier="exelixLK",$t.targetPanels=System.Array.init(["P_BgL","P_BgR"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/EntBtnResumeSystemApplet.bflyt"],System.String),$t.SecondaryTexReplace="White1x1^r",$t.NXThemeName="lock",$t),($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="user page",$t.szsName="MyPage.szs",$t.TitleId="0100000000001013",$t.FirmName="all firmwares",$t.FnameIdentifier=System.Array.init(["blyt/MypUserIconMini.bflyt"],System.String),$t.FnameNotIdentifier=System.Array.init([],System.String),$t.MainLayoutName="blyt/BaseTop.bflyt",$t.MaintextureName="NavBg_03^d",$t.PatchIdentifier="exelixMY",$t.targetPanels=System.Array.init(["L_AreaNav","L_AreaMain"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/BgNav_Root.bflyt"],System.String),$t.SecondaryTexReplace="White1x1A0^t",$t.NXThemeName="user",$t),($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="home menu only",$t.szsName="ResidentMenu.szs",$t.TitleId="0100000000001000",$t.FirmName="<= 5.X",$t.FnameIdentifier=System.Array.init(["anim/RdtBtnShop_LimitB.bflan"],System.String),$t.FnameNotIdentifier=System.Array.init([],System.String),$t.MainLayoutName="blyt/RdtBase.bflyt",$t.MaintextureName="White1x1A128^s",$t.PatchIdentifier="exelixResBG",$t.targetPanels=System.Array.init(["L_BgNml"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/IconError.bflyt"],System.String),$t.SecondaryTexReplace="White1x1A64^t",$t.NXThemeName="home",$t),($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="all apps menu",$t.szsName="Flaunch.szs",$t.TitleId="0100000000001000",$t.FirmName="6.X",$t.FnameIdentifier=System.Array.init(["blyt/FlcBtnIconGame.bflyt","anim/BaseBg_Loading.bflan"],System.String),$t.FnameNotIdentifier=System.Array.init([],System.String),$t.MainLayoutName="blyt/BgNml.bflyt",$t.MaintextureName="NavBg_03^d",$t.PatchIdentifier="exelixFBG",$t.targetPanels=System.Array.init(["P_Bg_00"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/BgNav_Root.bflyt"],System.String),$t.SecondaryTexReplace="White1x1A64^t",$t.NXThemeName="apps",$t),($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="settings applet",$t.szsName="Set.szs",$t.TitleId="0100000000001000",$t.FirmName="6.X",$t.FnameIdentifier=System.Array.init(["blyt/SetCntDataMngPhoto.bflyt","blyt/SetSideStory.bflyt"],System.String),$t.FnameNotIdentifier=System.Array.init([],System.String),$t.MainLayoutName="blyt/BgNml.bflyt",$t.MaintextureName="NavBg_03^d",$t.PatchIdentifier="exelixSET",$t.targetPanels=System.Array.init(["P_Bg_00"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/BgNav_Root.bflyt"],System.String),$t.SecondaryTexReplace="White1x1A0^t",$t.NXThemeName="set",$t),($t=new SwitchThemes.Common.PatchTemplate,$t.TemplateName="news applet",$t.szsName="Notification.szs",$t.TitleId="0100000000001000",$t.FirmName="6.X",$t.FnameIdentifier=System.Array.init(["blyt/NtfBase.bflyt","blyt/NtfImage.bflyt"],System.String),$t.FnameNotIdentifier=System.Array.init([],System.String),$t.MainLayoutName="blyt/BgNml.bflyt",$t.MaintextureName="NavBg_03^d",$t.PatchIdentifier="exelixNEW",$t.targetPanels=System.Array.init(["P_Bg_00"],System.String),$t.SecondaryLayouts=System.Array.init(["blyt/BgNavNoHeader.bflyt","blyt/BgNav_Root.bflyt"],System.String),$t.SecondaryTexReplace="White1x1^r",$t.NXThemeName="news",$t)],SwitchThemes.Common.PatchTemplate)}}}});Bridge.define("SwitchThemes.Common.LayoutFilePatch",{fields:{FileName:null,Patches:null}});Bridge.define("SwitchThemes.Common.LayoutPatch",{statics:{methods:{LoadTemplate:function(json){return Newtonsoft.Json.JsonConvert.DeserializeObject(json,SwitchThemes.Common.LayoutPatch)}}},fields:{PatchName:null,AuthorName:null,TargetName:null,Files:null},methods:{toString:function(){return(this.PatchName||"")+" by "+(this.AuthorName||"")},IsCompatible:function(szs){for(var TargetFileAsString,j,$t,i=0;i<this.Files.length;i=i+1|0){if(!szs.Files.containsKey(this.Files[i].FileName))return!1;for(TargetFileAsString=System.Text.Encoding.ASCII.GetString(szs.Files.get(this.Files[i].FileName)),j=0;j<this.Files[i].Patches.length;j=j+1|0)if(!System.String.contains(TargetFileAsString,($t=this.Files[i].Patches)[j].PaneName))return!1}return!0},AsJson:function(){var $t,settings=($t=new Newtonsoft.Json.JsonSerializerSettings,$t.DefaultValueHandling=Newtonsoft.Json.DefaultValueHandling.Ignore,$t.NullValueHandling=Newtonsoft.Json.NullValueHandling.Ignore,$t);return Newtonsoft.Json.JsonConvert.SerializeObject(this,settings)}}});Bridge.define("SwitchThemes.Common.ManagedYaz0",{statics:{methods:{Compress$1:function(FileName,level,res1,res2){return level===void 0&&(level=3),res1===void 0&&(res1=0),res2===void 0&&(res2=0),SwitchThemes.Common.ManagedYaz0.Compress(System.IO.File.ReadAllBytes(FileName),level,res1,res2)},Compress:function(Data,level,reserved1,reserved2){var res1,res2,headeroffs,header,i,maxback,tmpnr,realresult;level===void 0&&(level=3);reserved1===void 0&&(reserved1=0);reserved2===void 0&&(reserved2=0);var maxBackLevel=Bridge.Int.clip32(480*level-224),dataptr=0,result=System.Array.init((Data.length+(Bridge.Int.div(Data.length,8)|0)|0)+16|0,0,System.Byte),resultptr=0;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=89;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=97;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=122;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=48;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=Data.length>>24&255;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=Data.length>>16&255;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=Data.length>>8&255;result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=Data.length>>0&255;res1=System.BitConverter.getBytes$4(reserved1);res2=System.BitConverter.getBytes$4(reserved2);System.BitConverter.isLittleEndian&&(System.Array.reverse(res1),System.Array.reverse(res2));result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res1[0];result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res1[1];result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res1[2];result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res1[3];result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res2[0];result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res2[1];result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res2[2];result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=res2[3];for(var length=Data.length,dstoffs=16,Offs=0;;){for(headeroffs=Bridge.identity(dstoffs,dstoffs=dstoffs+1|0),resultptr=resultptr+1|0,header=0,i=0;i<8;i=i+1|0){var comp=0,back=1,nr=2,ptr=dataptr-1|0,maxnum=273;for((length-Offs|0)<maxnum&&(maxnum=length-Offs|0),maxback=maxBackLevel,Offs<maxback&&(maxback=Offs),maxback=dataptr-maxback|0;maxback<=ptr;){if((Data.length-dataptr|0)>2&&Data[ptr]===Data[dataptr]&&Data[ptr+1|0]===Data[dataptr+1|0]&&Data[ptr+2|0]===Data[dataptr+2|0]){for(tmpnr=3;tmpnr<maxnum&&Data[ptr+tmpnr|0]===Data[dataptr+tmpnr|0];)tmpnr=tmpnr+1|0;if(tmpnr>nr){if((Offs+tmpnr|0)>length){nr=length-Offs|0;back=dataptr-ptr|0;break}if(nr=tmpnr,back=dataptr-ptr|0,nr===maxnum)break}}ptr=ptr-1|0}if(nr>2?(Offs=Offs+nr|0,dataptr=dataptr+nr|0,nr>=18?(result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=(back-1|0)>>8&15,result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=(back-1|0)&255,result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=(nr-18|0)&255,dstoffs=dstoffs+3|0):(result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=((back-1|0)>>8&15|((nr-2|0)&15)<<4)&255,result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=(back-1|0)&255,dstoffs=dstoffs+2|0),comp=1):(result[Bridge.identity(resultptr,resultptr=resultptr+1|0)]=Data[Bridge.identity(dataptr,dataptr=dataptr+1|0)],dstoffs=dstoffs+1|0,Offs=Offs+1|0),header=(header<<1|(comp===1?0:1))&255,Offs>=length){header=header<<(7-i|0)&255;break}}if(result[headeroffs]=header,Offs>=length)break}while(dstoffs%4!=0)dstoffs=dstoffs+1|0;return realresult=System.Array.init(dstoffs,0,System.Byte),System.Array.copy(result,0,realresult,0,dstoffs),realresult},Decompress:function(Data){for(var leng=(Data[4]<<24|Data[5]<<16|Data[6]<<8|Data[7])>>>0,Result=System.Array.init(leng,0,System.Byte),Offs=16,dstoffs=0,header,i,j;;)for(header=Data[Bridge.identity(Offs,Offs=Offs+1|0)],i=0;i<8;i=i+1|0){if((header&128)!=0)Result[Bridge.identity(dstoffs,dstoffs=dstoffs+1|0)]=Data[Bridge.identity(Offs,Offs=Offs+1|0)];else{var b=Data[Bridge.identity(Offs,Offs=Offs+1|0)],offs=((b&15)<<8|Data[Bridge.identity(Offs,Offs=Offs+1|0)])+1|0,length=(b>>4)+2|0;for(length===2&&(length=Data[Bridge.identity(Offs,Offs=Offs+1|0)]+18|0),j=0;j<length;j=j+1|0)Result[dstoffs]=Result[dstoffs-offs|0],dstoffs=dstoffs+1|0}if(System.Int64(dstoffs).gte(System.Int64(leng)))return Result;header=header<<1&255}}}}});Bridge.define("SwitchThemes.Common.NullableVector2",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new SwitchThemes.Common.NullableVector2}}},fields:{X:null,Y:null},ctors:{$ctor1:function(x,y){this.$initialize();this.X=x;this.Y=y},ctor:function(){this.$initialize()}},methods:{getHashCode:function(){return Bridge.addHash([5476626292,this.X,this.Y])},equals:function(o){return Bridge.is(o,SwitchThemes.Common.NullableVector2)?Bridge.equals(this.X,o.X)&&Bridge.equals(this.Y,o.Y):!1},$clone:function(to){var s=to||new SwitchThemes.Common.NullableVector2;return s.X=this.X,s.Y=this.Y,s}}});Bridge.define("SwitchThemes.Common.NullableVector3",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new SwitchThemes.Common.NullableVector3}}},fields:{X:null,Y:null,Z:null},ctors:{$ctor1:function(x,y,z){this.$initialize();this.X=x;this.Y=y;this.Z=z},ctor:function(){this.$initialize()}},methods:{getHashCode:function(){return Bridge.addHash([5476691828,this.X,this.Y,this.Z])},equals:function(o){return Bridge.is(o,SwitchThemes.Common.NullableVector3)?Bridge.equals(this.X,o.X)&&Bridge.equals(this.Y,o.Y)&&Bridge.equals(this.Z,o.Z):!1},$clone:function(to){var s=to||new SwitchThemes.Common.NullableVector3;return s.X=this.X,s.Y=this.Y,s.Z=this.Z,s}}});Bridge.define("SwitchThemes.Common.PanePatch",{fields:{PaneName:null,Position:null,Rotation:null,Scale:null,Size:null,Visible:null,ColorTL:null,ColorTR:null,ColorBL:null,ColorBR:null}});Bridge.define("SwitchThemes.Common.PatchTemplate",{fields:{FirmName:null,TemplateName:null,szsName:null,TitleId:null,FnameIdentifier:null,FnameNotIdentifier:null,MainLayoutName:null,MaintextureName:null,PatchIdentifier:null,targetPanels:null,SecondaryLayouts:null,SecondaryTexReplace:null,NXThemeName:null,NoRemovePanel:!1},ctors:{init:function(){this.FirmName="";this.NoRemovePanel=!1}}});Bridge.define("SwitchThemes.Common.SwitchThemesCommon",{statics:{fields:{CoreVer:null,LoadFileText:null,PartToFileName:null},ctors:{init:function(){this.CoreVer="3.4";this.LoadFileText="To create a theme open an szs first, these are the patches available in this version:{0} \r\nAlways read the instructions because they are slightly different for each version";this.PartToFileName=function(_o1){return _o1.add("home","ResidentMenu.szs"),_o1.add("lock","Entrance.szs"),_o1.add("user","MyPage.szs"),_o1.add("apps","Flaunch.szs"),_o1.add("set","Set.szs"),_o1.add("news","Notification.szs"),_o1}(new(System.Collections.Generic.Dictionary$2(System.String,System.String)))}},methods:{GenerateNXTheme:function(info,image,layout){var $t,Files,sarc;return layout===void 0&&(layout=null),Files=new(System.Collections.Generic.Dictionary$2(System.String,System.Array.type(System.Byte))),Files.add("info.json",System.Text.Encoding.UTF8.GetBytes$2(info.Serialize())),Files.add("image.dds",image),layout!=null&&Files.add("layout.json",System.Text.Encoding.UTF8.GetBytes$2(layout)),sarc=SARCExt.SARC.PackN(($t=new SARCExt.SarcData,$t.endianness=Syroot.BinaryData.ByteOrder.LittleEndian,$t.Files=Files,$t.HashOnly=!1,$t)),SwitchThemes.Common.ManagedYaz0.Compress(sarc.Item2,1,sarc.Item1)},GeneratePatchListString:function(Templates){var $t,sortedTemplates=System.Linq.Enumerable.from(Templates).orderBy(function(x){return x.FirmName}).reverse(),curSection="",FileList="",p;$t=Bridge.getEnumerator(sortedTemplates);try{while($t.moveNext())p=$t.Current,Bridge.referenceEquals(curSection,p.FirmName)||(curSection=p.FirmName,FileList=(FileList||"")+(System.String.format("\r\nFor {0}: \r\n",[curSection])||"")),FileList=(FileList||"")+(System.String.format("  - {0} : the file is called {1} from title {2}\r\n",p.TemplateName,p.szsName,p.TitleId)||"")}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return System.String.format(SwitchThemes.Common.SwitchThemesCommon.LoadFileText,[FileList])},PatchLayouts:function(sarc,Files){var $t,p,target,res;$t=Bridge.getEnumerator(Files);try{while($t.moveNext()){if(p=$t.Current,!sarc.Files.containsKey(p.FileName))return SwitchThemes.Common.BflytFile.PatchResult.Fail;if(target=new SwitchThemes.Common.BflytFile.ctor(sarc.Files.get(p.FileName)),res=target.ApplyLayoutPatch(p.Patches),res!==SwitchThemes.Common.BflytFile.PatchResult.OK)return res;sarc.Files.set(p.FileName,target.SaveFile())}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return SwitchThemes.Common.BflytFile.PatchResult.OK},PatchBgLayouts:function(sarc,template){var $t,BflytFromSzs=null,MainFile,res,f,curTarget;if(BflytFromSzs=function(name){return new SwitchThemes.Common.BflytFile.ctor(sarc.Files.get(name))},MainFile=BflytFromSzs(template.MainLayoutName),res=MainFile.PatchBgLayout(template),res===SwitchThemes.Common.BflytFile.PatchResult.OK){sarc.Files.set(template.MainLayoutName,MainFile.SaveFile());$t=Bridge.getEnumerator(template.SecondaryLayouts);try{while($t.moveNext())f=$t.Current,curTarget=BflytFromSzs(f),curTarget.PatchTextureName(template.MaintextureName,template.SecondaryTexReplace),sarc.Files.set(f,curTarget.SaveFile())}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}}return res},PatchBntx$1:function(sarc,DDS,targetPatch){var q=new SwitchThemes.Common.Bntxx.QuickBntx(new Syroot.BinaryData.BinaryDataReader.ctor(new System.IO.MemoryStream.$ctor1(sarc.Files.get("timg/__Combined.bntx"))));return q.Rlt.length!==128?SwitchThemes.Common.BflytFile.PatchResult.Fail:(q.ReplaceTex$1(targetPatch.MaintextureName,DDS),DDS=null,sarc.Files.set("timg/__Combined.bntx",null),sarc.Files.set("timg/__Combined.bntx",q.Write()),SwitchThemes.Common.BflytFile.PatchResult.OK)},PatchBntx:function(sarc,DDS,targetPatch){var q=new SwitchThemes.Common.Bntxx.QuickBntx(new Syroot.BinaryData.BinaryDataReader.ctor(new System.IO.MemoryStream.$ctor1(sarc.Files.get("timg/__Combined.bntx"))));return q.Rlt.length!==128?SwitchThemes.Common.BflytFile.PatchResult.Fail:(q.ReplaceTex(targetPatch.MaintextureName,DDS),DDS=null,sarc.Files.set("timg/__Combined.bntx",null),sarc.Files.set("timg/__Combined.bntx",q.Write()),SwitchThemes.Common.BflytFile.PatchResult.OK)},DetectSarc:function(sarc,Templates){var $t,$t1,$t2,$t3,SzsHasKey=null,p,isTarget,s,s1,s2;if(SzsHasKey=function(key){return sarc.Files.containsKey(key)},!SzsHasKey("timg/__Combined.bntx"))return null;$t=Bridge.getEnumerator(Templates,SwitchThemes.Common.PatchTemplate);try{while($t.moveNext())if(p=$t.Current,SzsHasKey(p.MainLayoutName)){isTarget=!0;$t1=Bridge.getEnumerator(p.SecondaryLayouts);try{while($t1.moveNext())if(s=$t1.Current,!SzsHasKey(s)){isTarget=!1;break}}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$Dispose()}if(isTarget){$t2=Bridge.getEnumerator(p.FnameIdentifier);try{while($t2.moveNext())if(s1=$t2.Current,!SzsHasKey(s1)){isTarget=!1;break}}finally{Bridge.is($t2,System.IDisposable)&&$t2.System$IDisposable$Dispose()}if(isTarget){$t3=Bridge.getEnumerator(p.FnameNotIdentifier);try{while($t3.moveNext())if(s2=$t3.Current,SzsHasKey(s2)){isTarget=!1;break}}finally{Bridge.is($t3,System.IDisposable)&&$t3.System$IDisposable$Dispose()}if(isTarget)return p}}}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}return null}}}});Bridge.define("SwitchThemes.Common.ThemeFileManifest",{statics:{methods:{Deserialize:function(json){return Newtonsoft.Json.JsonConvert.DeserializeObject(json,SwitchThemes.Common.ThemeFileManifest)}}},fields:{Version:0,Author:null,ThemeName:null,LayoutInfo:null,Target:null,UseCommon5X:!1},methods:{Serialize:function(){return Newtonsoft.Json.JsonConvert.SerializeObject(this)}}});Bridge.define("SwitchThemes.Common.Vector2",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new SwitchThemes.Common.Vector2}}},fields:{X:0,Y:0},ctors:{$ctor1:function(x,y){this.$initialize();this.X=x;this.Y=y},ctor:function(){this.$initialize()}},methods:{getHashCode:function(){return Bridge.addHash([1955977157,this.X,this.Y])},equals:function(o){return Bridge.is(o,SwitchThemes.Common.Vector2)?Bridge.equals(this.X,o.X)&&Bridge.equals(this.Y,o.Y):!1},$clone:function(to){var s=to||new SwitchThemes.Common.Vector2;return s.X=this.X,s.Y=this.Y,s}}});Bridge.define("SwitchThemes.Common.Vector3",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new SwitchThemes.Common.Vector3}}},fields:{X:0,Y:0,Z:0},ctors:{$ctor1:function(x,y,z){this.$initialize();this.X=x;this.Y=y;this.Z=z},ctor:function(){this.$initialize()}},methods:{getHashCode:function(){return Bridge.addHash([1956042693,this.X,this.Y,this.Z])},equals:function(o){return Bridge.is(o,SwitchThemes.Common.Vector3)?Bridge.equals(this.X,o.X)&&Bridge.equals(this.Y,o.Y)&&Bridge.equals(this.Z,o.Z):!1},$clone:function(to){var s=to||new SwitchThemes.Common.Vector3;return s.X=this.X,s.Y=this.Y,s.Z=this.Z,s}}});Bridge.define("SwitchThemesOnline.App",{statics:{fields:{AppVersion:null,topError:null,loader:null,LoaderText:null,lblDetected:null,lblDDSPath:null,lblDDSPath_NX:null,LayoutsComboBox:null,LayoutPrevDiv:null,LayoutPrevImg:null,HomePartBox_NX:null,LayoutsComboBox_NX:null,LayoutPrevDiv_NX:null,LayoutPrevImg_NX:null,CommonSzs:null,LoadedDDS:null,targetPatch:null,embedLyouts:null,layoutPatches:null,ValidAutoThemeParts:null,loadingFaces:null},ctors:{init:function(){this.AppVersion="2.2";this.embedLyouts=System.Array.init(["SuchHm","SuchLk","ZnHm","GleLk"],System.String);this.ValidAutoThemeParts=System.Array.init(["home","lock","user","set","apps","news"],System.String);this.loadingFaces=System.Array.init(["()","o  o.*",". *  ","(  ). *  ","(      ).*","(-).*",". *  ","(    )*:","(   )",")*","( )*","()","*:","( 3 ).*","(*)==","()*","(",". *      ","    . *  ","().*","`","(  ).*"," )*","(_)","().*","().*","( )","(    ).*"],System.String)}},methods:{OnLoad:function(){SwitchThemesOnline.App.topError=document.getElementById("D_JsWarn");SwitchThemesOnline.App.topError.hidden=!0;document.getElementById("P_Version").textContent="Switch theme injector online - Version : 2.2 - Core version : 3.4";var useragent=window.navigator.userAgent.toLowerCase();(System.String.contains(useragent,"msie")||System.String.contains(useragent,"trident"))&&(document.getElementById("D_IeWarn").hidden=!1);SwitchThemesOnline.App.loader=document.getElementById("loaderDiv");SwitchThemesOnline.App.LoaderText=document.getElementById("LoadingText");SwitchThemesOnline.App.lblDetected=document.getElementById("P_DetectedSZS");SwitchThemesOnline.App.lblDDSPath=document.getElementById("P_DDSPath");SwitchThemesOnline.App.lblDDSPath_NX=document.getElementById("P_DDSPath2");SwitchThemesOnline.App.LayoutsComboBox=document.getElementById("LayoutsBox");SwitchThemesOnline.App.LayoutPrevDiv=document.getElementById("PreviewDiv");SwitchThemesOnline.App.LayoutPrevImg=document.getElementById("PreviewImg");SwitchThemesOnline.App.HomePartBox_NX=document.getElementById("HomePartBox");SwitchThemesOnline.App.LayoutsComboBox_NX=document.getElementById("LayoutsBox2");SwitchThemesOnline.App.LayoutPrevDiv_NX=document.getElementById("PreviewDiv2");SwitchThemesOnline.App.LayoutPrevImg_NX=document.getElementById("PreviewImg2");document.getElementById("P_PatchList").innerHTML=System.String.replaceAll(SwitchThemes.Common.SwitchThemesCommon.GeneratePatchListString(SwitchThemes.Common.DefaultTemplates.templates),"\r\n","<br />");SwitchThemesOnline.App.LoadCustomLayouts()},LoadCustomLayouts:function(){SwitchThemesOnline.App.layoutPatches=System.Array.init(SwitchThemesOnline.App.embedLyouts.length,null,SwitchThemes.Common.LayoutPatch);for(var i=0;i<SwitchThemesOnline.App.layoutPatches.length;i=i+1|0)SwitchThemesOnline.App.GetLayoutPart(i)},PrintError:function(err){SwitchThemesOnline.App.topError.textContent=err;SwitchThemesOnline.App.topError.hidden=!1},GetLayoutPart:function(i){var req=new XMLHttpRequest;req.responseType="String";req.onreadystatechange=function(){if(req.readyState===4){var DownloadRes=Bridge.as(req.response,System.String);if(DownloadRes==null||DownloadRes.length===0){SwitchThemesOnline.App.PrintError("Error downloading one of the embedded layouts : "+(SwitchThemesOnline.App.embedLyouts[i]||"")+", it won't be available to make themes");return}SwitchThemesOnline.App.layoutPatches[i]=SwitchThemes.Common.LayoutPatch.LoadTemplate(DownloadRes);DownloadRes=null}};req.open("GET","layouts/"+(SwitchThemesOnline.App.embedLyouts[i]||"")+".json",!0);req.send()},UploadSZS:function(arr){SwitchThemesOnline.App.DoActionWithloading(function(){var $t,sarc=SwitchThemes.Common.ManagedYaz0.Decompress(System.Linq.Enumerable.from(arr).ToArray()),i;for(SwitchThemesOnline.App.CommonSzs=SARCExt.SARC.UnpackRamN(sarc),sarc=null;!Bridge.referenceEquals(SwitchThemesOnline.App.LayoutsComboBox.lastChild.textContent,"Don't patch");)SwitchThemesOnline.App.LayoutsComboBox.removeChild(SwitchThemesOnline.App.LayoutsComboBox.lastChild);if(SwitchThemesOnline.App.targetPatch=SwitchThemes.Common.SwitchThemesCommon.DetectSarc(SwitchThemesOnline.App.CommonSzs,SwitchThemes.Common.DefaultTemplates.templates),SwitchThemesOnline.App.targetPatch==null){window.alert("This is not a valid theme file, if it's from a newer firmware it's not compatible with this tool yet");SwitchThemesOnline.App.CommonSzs=null;SwitchThemesOnline.App.targetPatch=null;SwitchThemesOnline.App.lblDetected.textContent="";return}for(SwitchThemesOnline.App.lblDetected.textContent="Detected "+(SwitchThemesOnline.App.targetPatch.TemplateName||"")+" "+(SwitchThemesOnline.App.targetPatch.FirmName||""),i=0;i<SwitchThemesOnline.App.layoutPatches.length;i=i+1|0)SwitchThemesOnline.App.layoutPatches[i]!=null&&SwitchThemesOnline.App.layoutPatches[i].IsCompatible(SwitchThemesOnline.App.CommonSzs)&&SwitchThemesOnline.App.LayoutsComboBox.add(($t=document.createElement("option"),$t.textContent=SwitchThemesOnline.App.layoutPatches[i].toString(),$t.value=Bridge.toString(i),$t))})},UploadDDSBtn:function(){document.getElementById("DdsUploader").click()},UploadDDS:function(arr,fileName){SwitchThemesOnline.App.DoActionWithloading(function(){SwitchThemesOnline.App.lblDDSPath.textContent=fileName;SwitchThemesOnline.App.lblDDSPath_NX.textContent=fileName;SwitchThemesOnline.App.LoadedDDS=System.Linq.Enumerable.from(arr).ToArray()})},HomePartBoxOnChange:function(){var $t,i;if(!(SwitchThemesOnline.App.HomePartBox_NX.selectedIndex<=0)){while(!Bridge.referenceEquals(SwitchThemesOnline.App.LayoutsComboBox_NX.lastChild.textContent,"Don't patch"))SwitchThemesOnline.App.LayoutsComboBox_NX.removeChild(SwitchThemesOnline.App.LayoutsComboBox_NX.lastChild);for(i=0;i<SwitchThemesOnline.App.layoutPatches.length;i=i+1|0)SwitchThemesOnline.App.layoutPatches[i]!=null&&(SwitchThemesOnline.App.layoutPatches[i].TargetName==null||System.String.contains(SwitchThemesOnline.App.layoutPatches[i].TargetName,SwitchThemes.Common.SwitchThemesCommon.PartToFileName.get(SwitchThemesOnline.App.HomePartBox_NX.value)))&&SwitchThemesOnline.App.LayoutsComboBox_NX.add(($t=document.createElement("option"),$t.textContent=SwitchThemesOnline.App.layoutPatches[i].toString(),$t.value=Bridge.toString(i),$t))}},LayoutBoxNXOnChange:function(){if(SwitchThemesOnline.App.LayoutsComboBox_NX.selectedIndex<=0)SwitchThemesOnline.App.LayoutPrevDiv_NX.hidden=!0;else{var index=System.Int32.parse(Bridge.cast(SwitchThemesOnline.App.LayoutsComboBox_NX.children[SwitchThemesOnline.App.LayoutsComboBox_NX.selectedIndex],HTMLOptionElement).value);SwitchThemesOnline.App.LayoutPrevImg_NX.src="layouts/"+(SwitchThemesOnline.App.embedLyouts[index]||"")+".jpg";SwitchThemesOnline.App.LayoutPrevImg_NX.hidden=!1}},LayoutBoxOnChange:function(){if(SwitchThemesOnline.App.LayoutsComboBox.selectedIndex<=0)SwitchThemesOnline.App.LayoutPrevDiv.hidden=!0;else{var index=System.Int32.parse(Bridge.cast(SwitchThemesOnline.App.LayoutsComboBox.children[SwitchThemesOnline.App.LayoutsComboBox.selectedIndex],HTMLOptionElement).value);SwitchThemesOnline.App.LayoutPrevImg.src="layouts/"+(SwitchThemesOnline.App.embedLyouts[index]||"")+".jpg";SwitchThemesOnline.App.LayoutPrevDiv.hidden=!1}},MakeNxTheme:function(partName,name,author,targetLayout){if(SwitchThemesOnline.App.LoadedDDS==null){window.alert("Open a DDS first !");return}if(!System.Array.contains(SwitchThemesOnline.App.ValidAutoThemeParts,partName,System.String)){window.alert("select a valid Home menu part");return}if(Bridge.referenceEquals(name.trim(),"")){window.alert("Enter a valid name");return}SwitchThemesOnline.App.DoActionWithloading(function(){var $t,meta=($t=new SwitchThemes.Common.ThemeFileManifest,$t.Version=1,$t.Author=author,$t.LayoutInfo=targetLayout!=null?targetLayout.toString():"",$t.ThemeName=name,$t.Target=partName,$t),res=SwitchThemes.Common.SwitchThemesCommon.GenerateNXTheme(meta,SwitchThemesOnline.App.LoadedDDS,targetLayout==null?null:targetLayout.AsJson()),dwn=new Uint8Array(res),DownloadFname=(name||"")+".nxtheme";downloadBlob(dwn,DownloadFname,"application/octet-stream")})},BuildNxThemeNX:function(){var targetLayout=null;SwitchThemesOnline.App.LayoutsComboBox_NX.selectedIndex>0&&(targetLayout=SwitchThemesOnline.App.layoutPatches[System.Int32.parse(Bridge.cast(SwitchThemesOnline.App.LayoutsComboBox_NX.children[SwitchThemesOnline.App.LayoutsComboBox_NX.selectedIndex],HTMLOptionElement).value)]);SwitchThemesOnline.App.MakeNxTheme(SwitchThemesOnline.App.HomePartBox_NX.value,document.getElementById("NXname").value,document.getElementById("NXauthor").value,targetLayout)},BuildNxTheme:function(){var name=window.prompt("Enter a name for the theme"),targetLayout=null;SwitchThemesOnline.App.LayoutsComboBox.selectedIndex>0&&(targetLayout=SwitchThemesOnline.App.layoutPatches[System.Int32.parse(Bridge.cast(SwitchThemesOnline.App.LayoutsComboBox.children[SwitchThemesOnline.App.LayoutsComboBox.selectedIndex],HTMLOptionElement).value)]);SwitchThemesOnline.App.MakeNxTheme(SwitchThemesOnline.App.targetPatch.NXThemeName,name,"",targetLayout)},PatchAndSave:function(){if(SwitchThemesOnline.App.CommonSzs==null){window.alert("Open an szs first !");return}if(SwitchThemesOnline.App.LoadedDDS==null){window.alert("Open a DDS first !");return}SwitchThemesOnline.App.DoActionWithloading(function(){var targetLayout=null,yaz0,dwn,DownloadFname;(SwitchThemesOnline.App.LayoutsComboBox.selectedIndex>0&&(targetLayout=SwitchThemesOnline.App.layoutPatches[System.Int32.parse(Bridge.cast(SwitchThemesOnline.App.LayoutsComboBox.children[SwitchThemesOnline.App.LayoutsComboBox.selectedIndex],HTMLOptionElement).value)]),yaz0=SwitchThemesOnline.Theme.Make(SwitchThemesOnline.App.CommonSzs,SwitchThemes.Common.Bntxx.DDSEncoder.LoadDDS(SwitchThemesOnline.App.LoadedDDS),SwitchThemesOnline.App.targetPatch,targetLayout),yaz0!=null)&&(dwn=new Uint8Array(yaz0),DownloadFname=SwitchThemesOnline.App.targetPatch.szsName,downloadBlob(dwn,DownloadFname,"application/octet-stream"))})},AutoThemeDeleteAll:function(){var $t,p;$t=Bridge.getEnumerator(SwitchThemesOnline.App.ValidAutoThemeParts);try{while($t.moveNext())p=$t.Current,window.localStorage.removeItem(p),window.localStorage.removeItem((p||"")+"Name")}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},DoActionWithloading:function(action){SwitchThemesOnline.App.LoaderText.textContent=SwitchThemesOnline.App.loadingFaces[(new System.Random.ctor).Next$2(0,SwitchThemesOnline.App.loadingFaces.length)];SwitchThemesOnline.App.loader.style.display="";window.setTimeout(function(){action();SwitchThemesOnline.App.loader.style.display="none"},100)}}}});Bridge.define("SwitchThemesOnline.AutoTheme",{statics:{fields:{Domain:null,loader:null,LoaderText:null,cardLoad:null,DwnErr:null},ctors:{init:function(){this.Domain="exelix11.github.io/SwitchThemeInjector";this.DwnErr="Error downloading the {0}, most likely the link you provided is not a direct link or the host doesn't support Cross-Origin Resource Sharing"}},methods:{OnLoad:function(){var useragent,type,Url,layout;if(document.getElementById("D_JsWarn").remove(),useragent=window.navigator.userAgent.toLowerCase(),(System.String.contains(useragent,"msie")||System.String.contains(useragent,"trident"))&&(document.getElementById("D_IeWarn").hidden=!1),SwitchThemesOnline.AutoTheme.loader=document.getElementById("loaderDiv"),SwitchThemesOnline.AutoTheme.LoaderText=document.getElementById("LoadingText"),type=SwitchThemesOnline.AutoTheme.GetUriVar("type"),type!=null){if(!ExtensionMethods.Extensions.ContainsStr(SwitchThemesOnline.App.ValidAutoThemeParts,type)){window.alert("The selected theme type isn't supported, probably you followed an invalid url");return}if(Url=SwitchThemesOnline.AutoTheme.GetUriVar("dds"),Url==null){window.alert("No url for the DDS has been specified");return}layout=SwitchThemesOnline.AutoTheme.GetUriVar("layout");SwitchThemesOnline.AutoTheme.DoAutoTheme(type,Url,layout)}},endWithError:function(error){window.alert(error);SwitchThemesOnline.AutoTheme.cardLoad.innerHTML="There was an error generating the theme: <br/>"+(error||"");SwitchThemesOnline.AutoTheme.EndLoading()},HttpRequest$1:function(url,CallBack,partName){var req=new XMLHttpRequest;req.responseType="arraybuffer";req.onreadystatechange=function(){var DownloadRes,arr;if(req.readyState===4){if(DownloadRes=Bridge.as(req.response,ArrayBuffer),DownloadRes==null){SwitchThemesOnline.AutoTheme.endWithError((partName||"")+" download failed, check the url");return}if(arr=new Uint8Array(DownloadRes),DownloadRes=null,arr.length===0){SwitchThemesOnline.AutoTheme.endWithError(System.String.format(SwitchThemesOnline.AutoTheme.DwnErr,[partName]));return}CallBack(arr)}};req.open("GET",url,!0);req.send()},HttpRequest:function(url,CallBack,partName){var req=new XMLHttpRequest;req.responseType="String";req.onreadystatechange=function(){if(req.readyState===4){var DownloadRes=Bridge.as(req.response,System.String);if(DownloadRes==null||DownloadRes.length===0){SwitchThemesOnline.AutoTheme.endWithError(System.String.format(SwitchThemesOnline.AutoTheme.DwnErr,[partName]));return}CallBack(DownloadRes)}};req.open("GET",url,!0);req.send()},DoAutoTheme:function(type,url,layout){var LayoutDownloaded=null,DDSDownloaded=null,BuildTheme=null,themeTarget,DDS,targetLayout;SwitchThemesOnline.AutoTheme.cardLoad=document.getElementById("CardLoad");document.getElementById("CardTutorial").hidden=!0;themeTarget="<br/><br/>This theme is an nxtheme, download NXThemes Installer to install it on your switch.";SwitchThemesOnline.AutoTheme.cardLoad.innerHTML="Wait while your theme is being generated.... "+(themeTarget||"");SwitchThemesOnline.AutoTheme.cardLoad.hidden=!1;SwitchThemesOnline.AutoTheme.StartLoading();targetLayout=null;BuildTheme=function(){var $t,urlSplit=System.String.split(url,System.Array.init(["\\/"],System.String),null,0),meta=($t=new SwitchThemes.Common.ThemeFileManifest,$t.Version=1,$t.Author="Auto-Theme",$t.LayoutInfo=targetLayout!=null?targetLayout.toString():"",$t.ThemeName=urlSplit[urlSplit.length-1|0],$t.Target=type,$t),res=SwitchThemes.Common.SwitchThemesCommon.GenerateNXTheme(meta,DDS,targetLayout==null?null:targetLayout.AsJson()),dwn,DownloadFname;if(res==null){SwitchThemesOnline.AutoTheme.endWithError("GenerateNXTheme() failed :(");return}dwn=new Uint8Array(res);DownloadFname=(urlSplit[urlSplit.length-1|0]||"")+".nxtheme";downloadBlob(dwn,DownloadFname,"application/octet-stream");document.getElementById("CardLoad").innerHTML="Your theme has been generated !"+(themeTarget||"");SwitchThemesOnline.AutoTheme.EndLoading()};DDSDownloaded=function(arr){DDS=System.Linq.Enumerable.from(arr).ToArray();layout==null?BuildTheme():SwitchThemesOnline.AutoTheme.HttpRequest(layout,LayoutDownloaded,"Layout")};LayoutDownloaded=function(req){targetLayout=SwitchThemes.Common.LayoutPatch.LoadTemplate(req);BuildTheme()};SwitchThemesOnline.AutoTheme.HttpRequest$1(url,DDSDownloaded,"DDS")},MakeLink:function(){var type=document.getElementById("TargetSelect").value,url=document.getElementById("DDSUrlInput").value,layout=document.getElementById("LayoutUrlInput").value.trim(),str,link;if(!ExtensionMethods.Extensions.ContainsStr(SwitchThemesOnline.App.ValidAutoThemeParts,type)){window.alert("The selected type is invalid");return}if(url.length<5){window.alert("Enter a valid url");return}document.getElementById("Linkis").hidden=!1;document.getElementById("BtnLinkCopy").style.display="block";str="https://exelix11.github.io/SwitchThemeInjector/autotheme.html?type="+(type||"")+"&dds="+(encodeURIComponent(url)||"");Bridge.referenceEquals(layout,"")||(str=(str||"")+("&layout="+(encodeURIComponent(layout)||"")||""));link=document.getElementById("OutLink");link.textContent=str;link.href=str},CopyLink:function(){var a=document.createElement("textarea");document.body.appendChild(a);a.value=document.getElementById("OutLink").href;a.select();document.execCommand("copy");a.remove()},StartLoading:function(){SwitchThemesOnline.AutoTheme.LoaderText.textContent=SwitchThemesOnline.App.loadingFaces[(new System.Random.ctor).Next$2(0,SwitchThemesOnline.App.loadingFaces.length)];SwitchThemesOnline.AutoTheme.loader.style.display=""},EndLoading:function(){SwitchThemesOnline.AutoTheme.loader.style.display="none"},GetUriVar:function(name){for(var pair,query=window.location.search.substr(1),vars=System.String.split(query,[38].map(function(i){return String.fromCharCode(i)})),i=0;i<vars.length;i=i+1|0)if(pair=System.String.split(vars[i],[61].map(function(i){return String.fromCharCode(i)})),Bridge.referenceEquals(decodeURIComponent(pair[0]),name))return decodeURIComponent(pair[1]);return null}}}});Bridge.define("SwitchThemesOnline.Theme",{statics:{methods:{Make:function(input,dds,targetPatch,layout){var layoutres,res,sarc;if(layout!=null)if(layoutres=SwitchThemes.Common.SwitchThemesCommon.PatchLayouts(input,layout.Files),layoutres===SwitchThemes.Common.BflytFile.PatchResult.Fail)return window.alert("One of the target files for the selected layout patch is missing in the SZS, you are probably using an already patched SZS or the wrong layout"),null;else if(layoutres===SwitchThemes.Common.BflytFile.PatchResult.CorruptedFile)return window.alert("A layout in this SZS is missing a pane required for the selected layout patch, you are probably using an already patched SZS or the wrong layout"),null;if(SwitchThemes.Common.SwitchThemesCommon.PatchBntx(input,dds,targetPatch)===SwitchThemes.Common.BflytFile.PatchResult.Fail)return window.alert("Can't build this theme: the szs you opened doesn't contain some information needed to patch the bntx,without this information it is not possible to rebuild the bntx.You should use an original or at least working szs"),null;if(res=SwitchThemes.Common.SwitchThemesCommon.PatchBgLayouts(input,targetPatch),res===SwitchThemes.Common.BflytFile.PatchResult.Fail)return window.alert("Couldn't patch this file, it might have been already modified or it's from an unsupported system version."),null;else if(res===SwitchThemes.Common.BflytFile.PatchResult.CorruptedFile)return window.alert("This file has been already patched with another tool and is not compatible, you should get an unmodified layout."),null;return sarc=SARCExt.SARC.PackN(input),SwitchThemes.Common.ManagedYaz0.Compress(sarc.Item2,1,sarc.Item1)}}}});Bridge.define("Syroot.BinaryData.BinaryBooleanFormat",{$kind:"enum",statics:{fields:{NonZeroByte:0,NonZeroWord:1,NonZeroDword:2}}});Bridge.define("Syroot.BinaryData.BinaryConverterCache",{statics:{fields:{_cache:null},ctors:{init:function(){this._cache=new(System.Collections.Generic.Dictionary$2(Function,Syroot.BinaryData.IBinaryConverter))}},methods:{GetConverter:function(type){var converter={};return Syroot.BinaryData.BinaryConverterCache._cache.tryGetValue(type,converter)||(converter.v=Bridge.cast(Bridge.createInstance(type),Syroot.BinaryData.IBinaryConverter),Syroot.BinaryData.BinaryConverterCache._cache.add(type,converter.v)),converter.v}}}});Bridge.define("Syroot.BinaryData.BinaryDataReader",{inherits:[System.IO.BinaryReader],fields:{_byteOrder:0,Encoding:null,NeedsReversion:!1},props:{ByteOrder:{get:function(){return this._byteOrder},set:function(value){this._byteOrder=value;this.NeedsReversion=this._byteOrder!==Syroot.BinaryData.ByteOrderHelper.SystemByteOrder}},EndOfStream:{get:function(){return this.BaseStream.Position.gte(this.BaseStream.Length)}},Length:{get:function(){return this.BaseStream.Length}},Position:{get:function(){return this.BaseStream.Position},set:function(value){this.BaseStream.Position=value}}},ctors:{ctor:function(input){Syroot.BinaryData.BinaryDataReader.$ctor3.call(this,input,new System.Text.UTF8Encoding.ctor,!1)},$ctor1:function(input,leaveOpen){Syroot.BinaryData.BinaryDataReader.$ctor3.call(this,input,new System.Text.UTF8Encoding.ctor,leaveOpen)},$ctor2:function(input,encoding){Syroot.BinaryData.BinaryDataReader.$ctor3.call(this,input,encoding,!1)},$ctor3:function(input,encoding,leaveOpen){this.$initialize();System.IO.BinaryReader.$ctor2.call(this,input,encoding,leaveOpen);this.Encoding=encoding;this.ByteOrder=Syroot.BinaryData.ByteOrderHelper.SystemByteOrder}},methods:{Align:function(alignment){this.Seek(this.Position.neg().mod(System.Int64(alignment)).add(System.Int64(alignment)).mod(System.Int64(alignment)))},ReadBoolean$1:function(format){switch(format){case Syroot.BinaryData.BinaryBooleanFormat.NonZeroByte:return System.IO.BinaryReader.prototype.ReadBoolean.call(this);case Syroot.BinaryData.BinaryBooleanFormat.NonZeroWord:return this.ReadInt16()!==0;case Syroot.BinaryData.BinaryBooleanFormat.NonZeroDword:return this.ReadInt32()!==0;default:throw new System.ArgumentOutOfRangeException.$ctor4("format","The specified binary boolean format is invalid.");}},ReadBooleans:function(count){return this.ReadMultiple(System.Boolean,count,Bridge.fn.cacheBind(this,System.IO.BinaryReader.prototype.ReadBoolean))},ReadBooleans$1:function(count,format){for(var values=System.Array.init(count,!1,System.Boolean),i=0;i<values.length;i=i+1|0)values[i]=this.ReadBoolean$1(format);return values},ReadDateTime:function(){return this.ReadDateTime$1(Syroot.BinaryData.BinaryDateTimeFormat.NetTicks)},ReadDateTime$1:function(format){switch(format){case Syroot.BinaryData.BinaryDateTimeFormat.CTime:return System.DateTime.addSeconds(System.DateTime.toLocalTime(System.DateTime.create(1970,1,1)),this.ReadUInt32());case Syroot.BinaryData.BinaryDateTimeFormat.NetTicks:return System.DateTime.create$2(this.ReadInt64());default:throw new System.ArgumentOutOfRangeException.$ctor4("format","The specified binary date time format is invalid.");}},ReadDateTimes:function(count){for(var values=System.Array.init(count,function(){return System.DateTime.getDefaultValue()},System.DateTime),i=0;i<values.length;i=i+1|0)values[i]=this.ReadDateTime();return values},ReadDateTimes$1:function(count,format){for(var values=System.Array.init(count,function(){return System.DateTime.getDefaultValue()},System.DateTime),i=0;i<values.length;i=i+1|0)values[i]=this.ReadDateTime$1(format);return values},ReadDecimals:function(count){return this.ReadMultiple(System.Decimal,count,Bridge.fn.cacheBind(this,this.ReadDecimal))},ReadDouble:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,8);return System.Array.reverse(bytes),System.BitConverter.toDouble(bytes,0)}else return System.IO.BinaryReader.prototype.ReadDouble.call(this)},ReadDoubles:function(count){return this.ReadMultiple(System.Double,count,Bridge.fn.cacheBind(this,this.ReadDouble))},ReadInt16:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,2);return System.Array.reverse(bytes),System.BitConverter.toInt16(bytes,0)}else return System.IO.BinaryReader.prototype.ReadInt16.call(this)},ReadInt16s:function(count){return this.ReadMultiple(System.Int16,count,Bridge.fn.cacheBind(this,this.ReadInt16))},ReadInt32:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,4);return System.Array.reverse(bytes),System.BitConverter.toInt32(bytes,0)}else return System.IO.BinaryReader.prototype.ReadInt32.call(this)},ReadInt32s:function(count){return this.ReadMultiple(System.Int32,count,Bridge.fn.cacheBind(this,this.ReadInt32))},ReadInt64:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,8);return System.Array.reverse(bytes),System.BitConverter.toInt64(bytes,0)}else return System.IO.BinaryReader.prototype.ReadInt64.call(this)},ReadInt64s:function(count){return this.ReadMultiple(System.Int64,count,Bridge.fn.cacheBind(this,this.ReadInt64))},ReadSBytes:function(count){return this.ReadMultiple(System.SByte,count,Bridge.fn.cacheBind(this,this.ReadSByte))},ReadSingle:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,4);return System.Array.reverse(bytes),System.BitConverter.toSingle(bytes,0)}else return System.IO.BinaryReader.prototype.ReadSingle.call(this)},ReadSingles:function(count){return this.ReadMultiple(System.Single,count,Bridge.fn.cacheBind(this,this.ReadSingle))},ReadString$1:function(format){return this.ReadString$2(format,this.Encoding)},ReadString$2:function(format,encoding){switch(format){case Syroot.BinaryData.BinaryStringFormat.ByteLengthPrefix:return this.ReadStringInternal(this.ReadByte(),encoding);case Syroot.BinaryData.BinaryStringFormat.WordLengthPrefix:return this.ReadStringInternal(this.ReadInt16(),encoding);case Syroot.BinaryData.BinaryStringFormat.DwordLengthPrefix:return this.ReadStringInternal(this.ReadInt32(),encoding);case Syroot.BinaryData.BinaryStringFormat.VariableLengthPrefix:return this.ReadStringInternal(this.Read7BitEncodedInt(),encoding);case Syroot.BinaryData.BinaryStringFormat.ZeroTerminated:return this.ReadZeroTerminatedString(encoding);case Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination:throw new System.ArgumentException.$ctor3("NoPrefixOrTermination cannot be used for read operations if no length has been specified.","format");default:throw new System.ArgumentOutOfRangeException.$ctor4("format","The specified binary string format is invalid.");}},ReadString$3:function(length){return this.ReadString$4(length,this.Encoding)},ReadString$4:function(length,encoding){return encoding.GetString(this.ReadBytes(length))},ReadStrings:function(count){for(var values=System.Array.init(count,null,System.String),i=0;i<values.length;i=i+1|0)values[i]=this.ReadString();return values},ReadStrings$1:function(count,format){for(var values=System.Array.init(count,null,System.String),i=0;i<values.length;i=i+1|0)values[i]=this.ReadString$1(format);return values},ReadStrings$2:function(count,format,encoding){for(var values=System.Array.init(count,null,System.String),i=0;i<values.length;i=i+1|0)values[i]=this.ReadString$2(format,encoding);return values},ReadStrings$3:function(count,length){for(var values=System.Array.init(count,null,System.String),i=0;i<values.length;i=i+1|0)values[i]=this.ReadString$3(length);return values},ReadStrings$4:function(count,length,encoding){for(var values=System.Array.init(count,null,System.String),i=0;i<values.length;i=i+1|0)values[i]=this.ReadString$4(length,this.Encoding);return values},ReadUInt16:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,2);return System.Array.reverse(bytes),System.BitConverter.toUInt16(bytes,0)}else return System.IO.BinaryReader.prototype.ReadUInt16.call(this)},ReadUInt16s:function(count){return this.ReadMultiple(System.UInt16,count,Bridge.fn.cacheBind(this,this.ReadUInt16))},ReadUInt32:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,4);return System.Array.reverse(bytes),System.BitConverter.toUInt32(bytes,0)}else return System.IO.BinaryReader.prototype.ReadUInt32.call(this)},ReadUInt32s:function(count){return this.ReadMultiple(System.UInt32,count,Bridge.fn.cacheBind(this,this.ReadUInt32))},ReadUInt64:function(){if(this.NeedsReversion){var bytes=System.IO.BinaryReader.prototype.ReadBytes.call(this,8);return System.Array.reverse(bytes),System.BitConverter.toUInt64(bytes,0)}else return System.IO.BinaryReader.prototype.ReadUInt64.call(this)},ReadUInt64s:function(count){return this.ReadMultiple(System.UInt64,count,Bridge.fn.cacheBind(this,this.ReadUInt64))},Seek:function(offset){return this.Seek$1(offset,1)},Seek$1:function(offset,origin){return this.BaseStream.Seek(offset,origin)},TemporarySeek:function(){return this.TemporarySeek$2(System.Int64(0),1)},TemporarySeek$1:function(offset){return this.TemporarySeek$2(offset,1)},TemporarySeek$2:function(offset,origin){return new Syroot.BinaryData.SeekTask(this.BaseStream,offset,origin)},ReadMultiple:function(T,count,readFunc){for(var values=System.Array.init(count,function(){return Bridge.getDefaultValue(T)},T),i=0;i<count;i=i+1|0)values[i]=readFunc();return values},ReadStringInternal:function(length,encoding){return encoding.GetString(this.ReadBytes(Bridge.Int.mul(length,encoding.GetByteCount$2("a"))))},ReadZeroTerminatedString:function(encoding){var charSize=encoding.GetByteCount$2("a"),bytes=new(System.Collections.Generic.List$1(System.Byte).ctor),readByte,readUShort,ushortBytes;if(charSize===1)for(readByte=this.ReadByte();readByte!==0;)bytes.add(readByte),readByte=this.ReadByte();else if(charSize===2)for(readUShort=this.ReadUInt16();readUShort!==0;)ushortBytes=System.BitConverter.getBytes$8(readUShort),bytes.add(ushortBytes[0]),bytes.add(ushortBytes[1]),readUShort=this.ReadUInt16();return encoding.GetString(bytes.ToArray())}}});Bridge.define("Syroot.BinaryData.BinaryDataWriter",{inherits:[System.IO.BinaryWriter],fields:{_byteOrder:0,Encoding:null,NeedsReversion:!1},props:{ByteOrder:{get:function(){return this._byteOrder},set:function(value){this._byteOrder=value;this.NeedsReversion=this._byteOrder!==Syroot.BinaryData.ByteOrderHelper.SystemByteOrder}},Position:{get:function(){return this.BaseStream.Position},set:function(value){this.BaseStream.Position=value}}},ctors:{ctor:function(output){Syroot.BinaryData.BinaryDataWriter.$ctor3.call(this,output,new System.Text.UTF8Encoding.ctor,!1)},$ctor1:function(output,leaveOpen){Syroot.BinaryData.BinaryDataWriter.$ctor3.call(this,output,new System.Text.UTF8Encoding.ctor,leaveOpen)},$ctor2:function(output,encoding){Syroot.BinaryData.BinaryDataWriter.$ctor3.call(this,output,encoding,!1)},$ctor3:function(output,encoding,leaveOpen){this.$initialize();System.IO.BinaryWriter.$ctor3.call(this,output,encoding,leaveOpen);this.Encoding=encoding;this.ByteOrder=Syroot.BinaryData.ByteOrderHelper.SystemByteOrder}},methods:{Align:function(alignment){this.Seek$1(this.Position.neg().mod(System.Int64(alignment)).add(System.Int64(alignment)).mod(System.Int64(alignment)))},ReserveOffset:function(){return new Syroot.BinaryData.Offset(this)},ReserveOffset$1:function(count){for(var offsets=System.Array.init(count,null,Syroot.BinaryData.Offset),i=0;i<count;i=i+1|0)offsets[i]=this.ReserveOffset();return offsets},Seek$1:function(offset){return this.Seek$2(offset,1)},Seek$2:function(offset,origin){return this.BaseStream.Seek(offset,origin)},TemporarySeek:function(){return this.TemporarySeek$2(System.Int64(0),1)},TemporarySeek$1:function(offset){return this.TemporarySeek$2(offset,1)},TemporarySeek$2:function(offset,origin){return new Syroot.BinaryData.SeekTask(this.BaseStream,offset,origin)},Write$18:function(value,format){switch(format){case Syroot.BinaryData.BinaryBooleanFormat.NonZeroByte:System.IO.BinaryWriter.prototype.Write.call(this,value);break;case Syroot.BinaryData.BinaryBooleanFormat.NonZeroWord:this.Write$9(value?1:0);break;case Syroot.BinaryData.BinaryBooleanFormat.NonZeroDword:this.Write$10(value?1:0);break;default:throw new System.ArgumentOutOfRangeException.$ctor4("format","The specified binary boolean format is invalid.");}},Write$19:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.Boolean);try{while($t.moveNext())value=$t.Current,this.Write(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$20:function(values,format){var $t,value;$t=Bridge.getEnumerator(values,System.Boolean);try{while($t.moveNext())value=$t.Current,this.Write$18(value,format)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$35:function(value){this.Write$36(value,Syroot.BinaryData.BinaryDateTimeFormat.NetTicks)},Write$36:function(value,format){switch(format){case Syroot.BinaryData.BinaryDateTimeFormat.CTime:this.Write$16(Bridge.Int.clipu32(System.DateTime.subdd(System.DateTime.create(1970,1,1),System.DateTime.toLocalTime(value)).getTotalSeconds()));break;case Syroot.BinaryData.BinaryDateTimeFormat.NetTicks:this.Write$11(System.DateTime.getTicks(value));break;default:throw new System.ArgumentOutOfRangeException.$ctor4("format","The specified binary date time format is invalid.");}},Write$21:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.DateTime);try{while($t.moveNext())value=$t.Current,this.Write$36(value,Syroot.BinaryData.BinaryDateTimeFormat.NetTicks)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$22:function(values,format){var $t,value;$t=Bridge.getEnumerator(values,System.DateTime);try{while($t.moveNext())value=$t.Current,this.Write$36(value,format)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$23:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.Decimal);try{while($t.moveNext())value=$t.Current,this.Write$7(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$8:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$2(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$8.call(this,value)},Write$24:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.Double);try{while($t.moveNext())value=$t.Current,this.Write$8(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$9:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$3(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$9.call(this,value)},Write$25:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.Int16);try{while($t.moveNext())value=$t.Current,this.Write$9(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$10:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$4(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$10.call(this,value)},Write$26:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.Int32);try{while($t.moveNext())value=$t.Current,this.Write$10(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$11:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$5(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$11.call(this,value)},Write$27:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.Int64);try{while($t.moveNext())value=$t.Current,this.Write$11(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$13:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$6(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$13.call(this,value)},Write$28:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.Single);try{while($t.moveNext())value=$t.Current,this.Write$13(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$37:function(value,format){this.Write$38(value,format,this.Encoding)},Write$38:function(value,format,encoding){switch(format){case Syroot.BinaryData.BinaryStringFormat.ByteLengthPrefix:this.WriteByteLengthPrefixString(value,encoding);break;case Syroot.BinaryData.BinaryStringFormat.WordLengthPrefix:this.WriteWordLengthPrefixString(value,encoding);break;case Syroot.BinaryData.BinaryStringFormat.DwordLengthPrefix:this.WriteDwordLengthPrefixString(value,encoding);break;case Syroot.BinaryData.BinaryStringFormat.VariableLengthPrefix:this.WriteVariableLengthPrefixString(value,encoding);break;case Syroot.BinaryData.BinaryStringFormat.ZeroTerminated:this.WriteZeroTerminatedString(value,encoding);break;case Syroot.BinaryData.BinaryStringFormat.NoPrefixOrTermination:this.WriteNoPrefixOrTerminationString(value,encoding);break;default:throw new System.ArgumentOutOfRangeException.$ctor4("format","The specified binary string format is invalid.");}},Write$29:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.String);try{while($t.moveNext())value=$t.Current,this.Write$14(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$30:function(values,format){var $t,value;$t=Bridge.getEnumerator(values,System.String);try{while($t.moveNext())value=$t.Current,this.Write$37(value,format)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$31:function(values,format,encoding){var $t,value;$t=Bridge.getEnumerator(values,System.String);try{while($t.moveNext())value=$t.Current,this.Write$38(value,format,encoding)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$15:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$7(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$15.call(this,value)},Write$32:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.UInt16);try{while($t.moveNext())value=$t.Current,this.Write$15(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$16:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$8(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$16.call(this,value)},Write$33:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.UInt32);try{while($t.moveNext())value=$t.Current,this.Write$16(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},Write$17:function(value){if(this.NeedsReversion){var bytes=System.BitConverter.getBytes$9(value);this.WriteReversed(bytes)}else System.IO.BinaryWriter.prototype.Write$17.call(this,value)},Write$34:function(values){var $t,value;$t=Bridge.getEnumerator(values,System.UInt64);try{while($t.moveNext())value=$t.Current,this.Write$17(value)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},WriteReversed:function(bytes){System.Array.reverse(bytes);System.IO.BinaryWriter.prototype.Write$2.call(this,bytes)},WriteByteLengthPrefixString:function(value,encoding){this.Write$1(value.length&255);this.Write$2(encoding.GetBytes$2(value))},WriteWordLengthPrefixString:function(value,encoding){this.Write$9(Bridge.Int.sxs(value.length&65535));this.Write$2(encoding.GetBytes$2(value))},WriteDwordLengthPrefixString:function(value,encoding){this.Write$10(value.length);this.Write$2(encoding.GetBytes$2(value))},WriteVariableLengthPrefixString:function(value,encoding){this.Write7BitEncodedInt(value.length);this.Write$2(encoding.GetBytes$2(value))},WriteZeroTerminatedString:function(value,encoding){this.Write$2(encoding.GetBytes$2(value));this.Write$1(0)},WriteNoPrefixOrTerminationString:function(value,encoding){this.Write$2(encoding.GetBytes$2(value))}}});Bridge.define("Syroot.BinaryData.BinaryDateTimeFormat",{$kind:"enum",statics:{fields:{NetTicks:0,CTime:1}}});Bridge.define("Syroot.BinaryData.BinaryMemberAttribute",{inherits:[System.Attribute],statics:{fields:{"default":null},ctors:{init:function(){this.default=new Syroot.BinaryData.BinaryMemberAttribute}}},fields:{Offset:0,OffsetOrigin:0,BooleanFormat:0,DateTimeFormat:0,StringFormat:0,Length:0,Strict:!1,Converter:null}});Bridge.define("Syroot.BinaryData.BinaryObjectAttribute",{inherits:[System.Attribute],fields:{Inherit:!1,Explicit:!1}});Bridge.define("Syroot.BinaryData.BinaryStringFormat",{$kind:"enum",statics:{fields:{VariableLengthPrefix:0,ByteLengthPrefix:1,WordLengthPrefix:2,DwordLengthPrefix:3,ZeroTerminated:4,NoPrefixOrTermination:5}}});Bridge.define("Syroot.BinaryData.ByteOrder",{$kind:"enum",statics:{fields:{BigEndian:65279,LittleEndian:65534}},$utype:System.UInt16});Bridge.define("Syroot.BinaryData.ByteOrderHelper",{statics:{fields:{_systemByteOrder:0},props:{SystemByteOrder:{get:function(){return Syroot.BinaryData.ByteOrderHelper._systemByteOrder===0&&(Syroot.BinaryData.ByteOrderHelper._systemByteOrder=System.BitConverter.isLittleEndian?Syroot.BinaryData.ByteOrder.LittleEndian:Syroot.BinaryData.ByteOrder.BigEndian),Syroot.BinaryData.ByteOrderHelper._systemByteOrder}}}}});Bridge.define("Syroot.BinaryData.Core.EncodingExtensions",{statics:{methods:{GetString:function(encoding,bytes){return encoding.GetString$1(bytes,0,bytes.length)}}}});Bridge.define("Syroot.BinaryData.IBinaryConverter",{$kind:"interface"});Bridge.define("Syroot.BinaryData.MemberData",{fields:{MemberInfo:null,Type:null,Attribute:null},ctors:{ctor:function(memberInfo,type,attribute){this.$initialize();this.MemberInfo=memberInfo;this.Type=type;this.Attribute=attribute}}});Bridge.define("Syroot.BinaryData.Offset",{fields:{Writer:null,Position:0},ctors:{ctor:function(writer){this.$initialize();this.Writer=writer;this.Position=System.Int64.clipu32(this.Writer.Position);this.Writer.Position=this.Writer.Position.add(System.Int64(4))}},methods:{Satisfy:function(){this.Satisfy$1(System.Int64.clip32(this.Writer.Position))},Satisfy$1:function(value){var oldPosition=System.Int64.clipu32(this.Writer.Position);this.Writer.Position=System.Int64(this.Position);this.Writer.Write$10(value);this.Writer.Position=System.Int64(oldPosition)}}});Bridge.define("Syroot.BinaryData.OffsetOrigin",{$kind:"enum",statics:{fields:{Current:0,Begin:1}}});Bridge.define("Syroot.BinaryData.SeekTask",{inherits:[System.IDisposable],fields:{Stream:null,PreviousPosition:System.Int64(0)},alias:["Dispose","System$IDisposable$Dispose"],ctors:{ctor:function(stream,offset,origin){this.$initialize();this.Stream=stream;this.PreviousPosition=stream.Position;this.Stream.Seek(offset,origin)}},methods:{Dispose:function(){this.Stream.Seek(this.PreviousPosition,0)}}});Bridge.define("SwitchThemes.Common.BflytFile.MaterialsSection",{inherits:[SwitchThemes.Common.BflytFile.BasePanel],$kind:"nested class",fields:{Materials:null},ctors:{init:function(){this.Materials=new(System.Collections.Generic.List$1(System.Array.type(System.Byte)).ctor)},$ctor1:function(bin){var dataReader,matCount,Offsets,i,matLen;for(this.$initialize(),SwitchThemes.Common.BflytFile.BasePanel.$ctor1.call(this,"mat1",bin),dataReader=new Syroot.BinaryData.BinaryDataReader.ctor(new System.IO.MemoryStream.$ctor1(this.data)),dataReader.ByteOrder=bin.ByteOrder,matCount=dataReader.ReadInt32(),Offsets=System.Linq.Enumerable.from(dataReader.ReadInt32s(matCount)).select(function(x){return x-8|0}).ToArray(System.Int32),i=0;i<matCount;i=i+1|0)matLen=(i===(matCount-1|0)?System.Int64.clip32(dataReader.BaseStream.Length):Offsets[i+1|0])-System.Int64.clip32(dataReader.Position)|0,this.Materials.add(dataReader.ReadBytes(matLen))},ctor:function(){this.$initialize();SwitchThemes.Common.BflytFile.BasePanel.$ctor2.call(this,"mat1",8)}},methods:{WritePanel:function(bin){var newData=new System.IO.MemoryStream.ctor,dataWriter=new Syroot.BinaryData.BinaryDataWriter.ctor(newData),i,off,endPos;for(dataWriter.ByteOrder=bin.ByteOrder,dataWriter.Write$10(this.Materials.Count),dataWriter.Write$26(System.Array.init(this.Materials.Count,0,System.Int32)),i=0;i<this.Materials.Count;i=i+1|0)off=System.Int64.clipu32(dataWriter.Position),dataWriter.Write$2(this.Materials.getItem(i)),endPos=System.Int64.clipu32(dataWriter.Position),dataWriter.Position=System.Int64(4+Bridge.Int.mul(i,4)),dataWriter.Write$16(off+8>>>0),dataWriter.Position=System.Int64(endPos);this.data=newData.ToArray();SwitchThemes.Common.BflytFile.BasePanel.prototype.WritePanel.call(this,bin)}}});Bridge.define("SwitchThemes.Common.BflytFile.PicturePanel",{inherits:[SwitchThemes.Common.BflytFile.BasePanel],$kind:"nested class",fields:{PanelName:null},ctors:{ctor:function(bin){this.$initialize();SwitchThemes.Common.BflytFile.BasePanel.$ctor1.call(this,"pic1",bin);this.PanelName=SwitchThemes.Common.BflytFile.TryGetPanelName(this)}},methods:{toString:function(){return System.String.format("Picture {0}",[this.PanelName])}}});Bridge.define("SwitchThemes.Common.BflytFile.PropertyEditablePanel",{inherits:[SwitchThemes.Common.BflytFile.BasePanel],$kind:"nested class",fields:{PaneName:null,Position:null,Rotation:null,Scale:null,Size:null,_flag1:0,ColorData:null},props:{Visible:{get:function(){return(this._flag1&1)==1},set:function(value){this._flag1=value?(this._flag1|1)&255:this._flag1&254}}},ctors:{init:function(){this.Position=new SwitchThemes.Common.Vector3;this.Rotation=new SwitchThemes.Common.Vector3;this.Scale=new SwitchThemes.Common.Vector2;this.Size=new SwitchThemes.Common.Vector2},ctor:function(p){var dataReader,i,c;for(this.$initialize(),SwitchThemes.Common.BflytFile.BasePanel.ctor.call(this,p),dataReader=new Syroot.BinaryData.BinaryDataReader.ctor(new System.IO.MemoryStream.$ctor1(this.data)),dataReader.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian,this._flag1=dataReader.ReadByte(),dataReader.BaseStream.Position=dataReader.BaseStream.Position.add(System.Int64(3)),this.PaneName="",i=0;i<24;i=i+1|0){if(c=dataReader.ReadChar(),c===0)break;this.PaneName=(this.PaneName||"")+String.fromCharCode(c)}dataReader.BaseStream.Position=System.Int64(36);this.Position=ExtensionMethods.Extensions.ReadVector3(dataReader);this.Rotation=ExtensionMethods.Extensions.ReadVector3(dataReader);this.Scale=ExtensionMethods.Extensions.ReadVector2(dataReader);this.Size=ExtensionMethods.Extensions.ReadVector2(dataReader);Bridge.referenceEquals(this.name,"pic1")&&(dataReader.BaseStream.Position=System.Int64(76),this.ColorData=dataReader.ReadUInt32s(4))}},methods:{toString:function(){return System.String.format("Panel {0} {1}",this.name,this.PaneName)},ApplyChanges:function(){var mem=new System.IO.MemoryStream.ctor,bin;try{bin=new Syroot.BinaryData.BinaryDataWriter.ctor(mem);bin.ByteOrder=Syroot.BinaryData.ByteOrder.LittleEndian;bin.Write$2(this.data);bin.BaseStream.Position=System.Int64(0);bin.Write$1(this._flag1);bin.BaseStream.Position=System.Int64(36);ExtensionMethods.Extensions.Write$1(bin,this.Position.$clone());ExtensionMethods.Extensions.Write$1(bin,this.Rotation.$clone());ExtensionMethods.Extensions.Write(bin,this.Scale.$clone());ExtensionMethods.Extensions.Write(bin,this.Size.$clone());Bridge.referenceEquals(this.name,"pic1")&&(bin.BaseStream.Position=System.Int64(76),bin.Write$33(this.ColorData));this.data=mem.ToArray()}finally{Bridge.hasValue(mem)&&mem.System$IDisposable$Dispose()}},WritePanel:function(bin){this.ApplyChanges();SwitchThemes.Common.BflytFile.BasePanel.prototype.WritePanel.call(this,bin)}}});Bridge.define("SwitchThemes.Common.BflytFile.TextureSection",{inherits:[SwitchThemes.Common.BflytFile.BasePanel],$kind:"nested class",fields:{Textures:null},ctors:{init:function(){this.Textures=new(System.Collections.Generic.List$1(System.String).ctor)},$ctor1:function(bin){var $t,dataReader,off;this.$initialize();SwitchThemes.Common.BflytFile.BasePanel.$ctor1.call(this,"txl1",bin);dataReader=new Syroot.BinaryData.BinaryDataReader.ctor(new System.IO.MemoryStream.$ctor1(this.data));dataReader.ByteOrder=bin.ByteOrder;var texCount=dataReader.ReadInt32(),BaseOff=System.Int64.clipu32(dataReader.Position),Offsets=dataReader.ReadInt32s(texCount);$t=Bridge.getEnumerator(Offsets);try{while($t.moveNext())off=$t.Current,dataReader.Position=System.Int64(BaseOff).add(System.Int64(off)),this.Textures.add(dataReader.ReadString$1(Syroot.BinaryData.BinaryStringFormat.ZeroTerminated))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$Dispose()}},ctor:function(){this.$initialize();SwitchThemes.Common.BflytFile.BasePanel.$ctor2.call(this,"txl1",8)}},methods:{WritePanel:function(bin){var newData=new System.IO.MemoryStream.ctor,dataWriter=new Syroot.BinaryData.BinaryDataWriter.ctor(newData),i,off,endPos;for(dataWriter.ByteOrder=bin.ByteOrder,dataWriter.Write$10(this.Textures.Count),dataWriter.Write$26(System.Array.init(this.Textures.Count,0,System.Int32)),i=0;i<this.Textures.Count;i=i+1|0){for(off=System.Int64.clipu32(dataWriter.Position),dataWriter.Write$37(this.Textures.getItem(i),Syroot.BinaryData.BinaryStringFormat.ZeroTerminated);dataWriter.BaseStream.Position.mod(System.Int64(4)).ne(System.Int64(0));)dataWriter.Write$1(0);endPos=System.Int64.clipu32(dataWriter.Position);dataWriter.Position=System.Int64(4+Bridge.Int.mul(i,4));dataWriter.Write$16(off-4>>>0);dataWriter.Position=System.Int64(endPos)}this.data=newData.ToArray();SwitchThemes.Common.BflytFile.BasePanel.prototype.WritePanel.call(this,bin)}}})});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICJTd2l0Y2hUaGVtZXNPbmxpbmUubWluLmpzIiwKICAic291cmNlUm9vdCI6ICIiLAogICJzb3VyY2VzIjogW10sCiAgIm5hbWVzIjogW10sCiAgIm1hcHBpbmdzIjogIiIsCiAgInNvdXJjZXNDb250ZW50IjogW10KfQo=
